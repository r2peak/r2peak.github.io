<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>计算机网络-4网络层 | Road To Peak</title><meta name="keywords" content="计网"><meta name="author" content="马厚煜"><meta name="copyright" content="马厚煜"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="网络层概述简介 网络层的主要任务是实现网络互连，进而实现数据包在各网络之间的传输    这些异构型网络N1~N7如果只是需要各自内部通信，他们只要实现各自的物理层和数据链路层即可 但是如果要将这些异构型网络互连起来，形成一个更大的互联网，就需要实现网络层设备路由器 有时为了简单起见，可以不用画出这些网络，图中N1~N7，而将他们看做是一条链路即可   要实现网络层任务，需要解决一下主要问题：  网">
<meta property="og:type" content="article">
<meta property="og:title" content="计算机网络-4网络层">
<meta property="og:url" content="http://example.com/2021/12/25/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-4%E7%BD%91%E7%BB%9C%E5%B1%82/index.html">
<meta property="og:site_name" content="Road To Peak">
<meta property="og:description" content="网络层概述简介 网络层的主要任务是实现网络互连，进而实现数据包在各网络之间的传输    这些异构型网络N1~N7如果只是需要各自内部通信，他们只要实现各自的物理层和数据链路层即可 但是如果要将这些异构型网络互连起来，形成一个更大的互联网，就需要实现网络层设备路由器 有时为了简单起见，可以不用画出这些网络，图中N1~N7，而将他们看做是一条链路即可   要实现网络层任务，需要解决一下主要问题：  网">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/mn8.png">
<meta property="article:published_time" content="2021-12-25T13:14:31.000Z">
<meta property="article:modified_time" content="2021-12-27T01:42:29.181Z">
<meta property="article:author" content="马厚煜">
<meta property="article:tag" content="计网">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/mn8.png"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://example.com/2021/12/25/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-4%E7%BD%91%E7%BB%9C%E5%B1%82/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '计算机网络-4网络层',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-12-27 09:42:29'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Road To Peak" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/me.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">16</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/mn8.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Road To Peak</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">计算机网络-4网络层</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-12-25T13:14:31.000Z" title="发表于 2021-12-25 21:14:31">2021-12-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-12-27T01:42:29.181Z" title="更新于 2021-12-27 09:42:29">2021-12-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">9.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>29分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="计算机网络-4网络层"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="网络层概述"><a href="#网络层概述" class="headerlink" title="网络层概述"></a>网络层概述</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul>
<li>网络层的主要任务是<strong>实现网络互连</strong>，进而<strong>实现数据包在各网络之间的传输</strong></li>
</ul>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-25/1640442280332-image.png"></p>
<blockquote>
<p>这些异构型网络N1~N7如果只是需要各自内部通信，他们只要实现各自的物理层和数据链路层即可</p>
<p>但是如果要将这些异构型网络互连起来，形成一个更大的互联网，就需要实现网络层设备路由器</p>
<p>有时为了简单起见，可以不用画出这些网络，图中N1~N7，而将他们看做是一条链路即可</p>
</blockquote>
<ul>
<li><p>要实现网络层任务，需要解决一下主要问题：</p>
<ul>
<li>网络层向运输层提供怎样的服务（“可靠传输”还是“不可靠传输”）</li>
</ul>
<p>在数据链路层那课讲过的可靠传输，详情可以看那边的笔记：网络层对以下的<strong>分组丢失</strong>、<strong>分组失序</strong>、<strong>分组重复</strong>的传输错误采取措施，使得接收方能正确接受发送方发送的数据，就是<strong>可靠传输</strong>，反之，如果什么措施也不采取，则是<strong>不可靠传输</strong></p>
<ul>
<li>网络层寻址问题</li>
</ul>
</li>
</ul>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-25/1640442296825-image.png"></p>
<ul>
<li>路由选择问题</li>
</ul>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-25/1640442304389-image.png"></p>
<blockquote>
<p>路由器收到数据后，是依据什么来决定将数据包从自己的哪个接口转发出去？</p>
<p><strong>依据数据包的目的地址和路由器中的路由表</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-25/1640442319976-image.png"></p>
</blockquote>
<blockquote>
<p>但在实际当中，路由器是怎样知道这些路由记录？</p>
<ul>
<li>由用户或网络管理员进行人工配置，这种方法只适用于规模较小且网络拓扑不改变的小型互联网</li>
<li><strong>另一种是实现各种路由选择协议，由路由器执行路由选择协议中所规定的路由选择算法，而自动得出路由表中的路有记录，这种方法更适合规模较大且网络拓扑经常改变的大型互联网</strong></li>
</ul>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-25/1640442336736-image.png"></p>
<blockquote>
<p>补充<br>：<strong>网络层（网际层）</strong>除了 <strong>IP协议</strong>外，还有之前介绍过的<strong>地址解析协议ARP</strong>，还有<strong>网际控制报文协议ICMP</strong>，<strong>网际组管理协议IGMP</strong></p>
</blockquote>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-25/1640442370296-image.png"></p>
<hr>
<h1 id="网络层提供的两种服务"><a href="#网络层提供的两种服务" class="headerlink" title="网络层提供的两种服务"></a>网络层提供的两种服务</h1><ul>
<li>在计算机网络领域，网络层应该向运输层提供怎样的服务（“<strong>面向连接</strong>”还是“<strong>无连接</strong>”）曾引起了长期的争论。</li>
<li>争论焦点的实质就是：<strong>在计算机通信中，可靠交付应当由谁来负责</strong>？是<strong>网络</strong>还是<strong>端系统</strong>？ </li>
</ul>
<h2 id="面向连接的虚电路服务"><a href="#面向连接的虚电路服务" class="headerlink" title="面向连接的虚电路服务"></a>面向连接的虚电路服务</h2><p><strong>一种观点：让网络负责可靠交付</strong></p>
<ul>
<li>这种观点认为，应借助于电信网的成功经验，让网络负责可靠交付，计算机网络应模仿电信网络，使用<strong>面向连接</strong>的通信方式。</li>
<li>通信之前先建立<strong>虚电路</strong> (Virtual Circuit)，以保证双方通信所需的一切网络资源。 </li>
<li>如果再使用可靠传输的网络协议，就可使所发送的分组无差错按序到达终点，不丢失、不重复。</li>
</ul>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640479609694-image.png"></p>
<p><strong>发送方</strong> 发送给 <strong>接收方</strong> 的所有分组都沿着同一条虚电路传送</p>
<blockquote>
<ul>
<li>虚电路表示这只是一条逻辑上的连接，分组都沿着这条逻辑连接按照存储转发方式传送，而并不是真正建立了一条物理连接。</li>
<li>请注意，电路交换的电话通信是先建立了一条真正的连接。</li>
<li>因此分组交换的虚连接和电路交换的连接只是类似，但并不完全一样</li>
</ul>
</blockquote>
<h2 id="无连接的数据报服务"><a href="#无连接的数据报服务" class="headerlink" title="无连接的数据报服务"></a>无连接的数据报服务</h2><p><strong>另一种观点：网络提供数据报服务</strong></p>
<ul>
<li>互联网的先驱者提出了一种崭新的网络设计思路。</li>
<li>网络层向上只提供简单灵活的、<strong>无连接的</strong>、<strong>尽最大努力交付</strong>的<strong>数据报服务</strong>。</li>
<li>网络在发送分组时不需要先建立连接。每一个分组（即 IP 数据报）独立发送，与其前后的分组无关（不进行编号）。</li>
<li><strong>网络层不提供服务质量的承诺</strong>。即所传送的分组可能出错、丢失、重复和失序（不按序到达终点），当然也不保证分组传送的时限。 </li>
</ul>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640569294416-image.png"></p>
<p><strong>发送方</strong> 发送给 <strong>接收方</strong> 的分组可能沿着不同路径传送</p>
<blockquote>
<p><strong>尽最大努力交付</strong></p>
<ul>
<li>如果主机（即端系统）中的进程之间的通信需要是可靠的，那么就由网络的<strong>主机中的运输层负责可靠交付（包括差错处理、流量控制等）</strong> 。</li>
<li><strong>采用这种设计思路的好处是</strong>：网络的造价大大降低，运行方式灵活，能够适应多种应用。</li>
<li>互连网能够发展到今日的规模，充分证明了当初采用这种设计思路的正确性。</li>
</ul>
</blockquote>
<h2 id="虚电路服务与数据报服务的对比"><a href="#虚电路服务与数据报服务的对比" class="headerlink" title="虚电路服务与数据报服务的对比"></a>虚电路服务与数据报服务的对比</h2><table>
<thead>
<tr>
<th><strong>对比的方面</strong></th>
<th><strong>虚电路服务</strong></th>
<th><strong>数据报服务</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>思路</strong></td>
<td><strong>可靠通信应当由网络来保证</strong></td>
<td><strong>可靠通信应当由用户主机来保证</strong></td>
</tr>
<tr>
<td><strong>连接的建立</strong></td>
<td><strong>必须有</strong></td>
<td><strong>不需要</strong></td>
</tr>
<tr>
<td><strong>终点地址</strong></td>
<td><strong>仅在连接建立阶段使用，每个分组使用短的虚电路号</strong></td>
<td><strong>每个分组都有终点的完整地址</strong></td>
</tr>
<tr>
<td><strong>分组的转发</strong></td>
<td><strong>属于同一条虚电路的分组均按照同一路由进行转发</strong></td>
<td><strong>每个分组独立选择路由进行转发</strong></td>
</tr>
<tr>
<td><strong>当结点出故障时</strong></td>
<td><strong>所有通过出故障的结点的虚电路均不能工作</strong></td>
<td><strong>出故障的结点可能会丢失分组，一些路由可能会发生变化</strong></td>
</tr>
<tr>
<td><strong>分组的顺序</strong></td>
<td><strong>总是按发送顺序到达终点</strong></td>
<td><strong>到达终点时不一定按发送顺序</strong></td>
</tr>
<tr>
<td><strong>端到端的差错处理和流量控制</strong></td>
<td><strong>可以由网络负责，也可以由用户主机负责</strong></td>
<td><strong>由用户主机负责</strong></td>
</tr>
</tbody></table>
<hr>
<h1 id="IPv4"><a href="#IPv4" class="headerlink" title="IPv4"></a>IPv4</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640479875281-image.png"></p>
<blockquote>
<p>记住各位对应的权值，用看情况加/减法。</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640480224801-image.png"></p>
<h2 id="分类编制的IPv4地址"><a href="#分类编制的IPv4地址" class="headerlink" title="分类编制的IPv4地址"></a>分类编制的IPv4地址</h2><h3 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h3><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640479892376-image.png"></p>
<ul>
<li>每一类地址都由两个固定长度的字段组成，其中一个字段是<strong>网络号 net-id</strong>，它标志主机（或路由器）所连接到的网络，而另一个字段则是<strong>主机号 host-id</strong>，它标志该主机（或路由器）。</li>
<li>主机号在它前面的网络号所指明的网络范围内必须是唯一的。</li>
<li>由此可见，<strong>一个 IP 地址在整个互联网范围内是唯一的</strong>。</li>
</ul>
<p><strong>A类地址</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640479942073-image.png"></p>
<p><strong>B类地址</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640479955722-image.png"></p>
<p><strong>C类地址</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640479969946-image.png"></p>
<p><strong>练习</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640479984452-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640481813330-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640482140908-image.png"></p>
<p>俩路由器之间，无主机，只有俩路由器接口，需要可分配的IP地址数量为2，给该网络分配一个A类、B类、C类网络号都可以，本着节约IP地址的原则，给该网络分配一个C类网络号。<br><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640482187843-image.png"><br>综上：<br>橙色A类，蓝色B类，绿色C类，红色C类。</p>
<blockquote>
<p>A类地址每个网络中可分配IP地址数量为：2^24 - 2（去除主机号全0的网络地址，和全1的广播地址） = 1677,7214</p>
<p>B类为：2^16 - 2 = 65534</p>
<p>C类为：2^8 - 2 = 254</p>
</blockquote>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640482981898-image.png"></p>
<p><strong>IP 地址的一些重要特点</strong></p>
<p>(1) <strong>IP 地址是一种分等级的地址结构</strong>。分两个等级的好处是：</p>
<ul>
<li><strong>第一</strong>，IP 地址管理机构在分配 IP 地址时只分配网络号，而剩下的主机号则由得到该网络号的单位自行分配。这样就方便了 IP 地址的管理。</li>
<li><strong>第二</strong>，路由器仅根据目的主机所连接的网络号来转发分组（而不考虑目的主机号），这样就可以使路由表中的项目数大幅度减少，从而减小了路由表所占的存储空间。 </li>
</ul>
<p>(2) <strong>实际上 IP 地址是标志一个主机（或路由器）和一条链路的接口</strong>。</p>
<ul>
<li>当一个主机同时连接到两个网络上时，该主机就必须同时具有两个相应的 IP 地址，其网络号 net-id 必须是不同的。这种主机称为<strong>多归属主机</strong> (multihomed host)。</li>
<li>由于一个路由器至少应当连接到两个网络（这样它才能将 IP 数据报从一个网络转发到另一个网络），因此<strong>一个路由器至少应当有两个不同的 IP 地址</strong>。 </li>
</ul>
<p>(3) <strong>用转发器或网桥连接起来的若干个局域网仍为一个网络</strong>，因此这些局域网都具有同样的网络号 net-id。</p>
<p>(4) <strong>所有分配到网络号 net-id 的网络，无论是范围很小的局域网，还是可能覆盖很大地理范围的广域网，都是平等的。</strong></p>
<h2 id="划分子网的IPv4地址"><a href="#划分子网的IPv4地址" class="headerlink" title="划分子网的IPv4地址"></a>划分子网的IPv4地址</h2><h3 id="为什么要划分子网"><a href="#为什么要划分子网" class="headerlink" title="为什么要划分子网"></a>为什么要划分子网</h3><p>在 ARPANET 的早期，IP 地址的设计确实不够合理：</p>
<ul>
<li>IP 地址空间的利用率有时很低。 </li>
<li>给每一个物理网络分配一个网络号会使路由表变得太大因而使网络性能变坏。 </li>
<li>两级的 IP 地址不够灵活。 </li>
</ul>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640483385676-image.png"></p>
<p>如果想要将原来的网络划分成三个独立的网路</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640483394592-image.png"></p>
<p>所以是否可以从主机号部分借用一部分作为子网号</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640483401882-image.png"></p>
<blockquote>
<p>但是如果未在图中标记子网号部分，那么我们和计算机又如何知道分类地址中主机号有多少比特被用作子网号了呢？</p>
<p>所以就有了划分子网的工具：<strong>子网掩码</strong></p>
<ul>
<li>从 1985 年起在 IP 地址中又增加了一个“<strong>子网号字段</strong>”，使两级的 IP 地址变成为<strong>三级的 IP 地址</strong>。</li>
<li>这种做法叫做<strong>划分子网</strong> (subnetting) 。</li>
<li>划分子网已成为互联网的正式标准协议。 </li>
</ul>
</blockquote>
<h3 id="如何划分子网"><a href="#如何划分子网" class="headerlink" title="如何划分子网"></a>如何划分子网</h3><p>基本思路</p>
<ul>
<li>划分子网纯属一个<strong>单位内部的事情</strong>。单位对外仍然表现为没有划分子网的网络。</li>
<li>从主机号<strong>借用</strong>若干个位作为<strong>子网号</strong> subnet-id，而主机号 host-id 也就相应减少了若干个位。</li>
</ul>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640483412983-image.png"></p>
<ul>
<li>凡是从其他网络发送给本单位某个主机的 IP 数据报，仍然是根据 IP 数据报的<strong>目的网络号</strong> net-id，先找到连接在本单位网络上的路由器。</li>
<li>然后<strong>此路由器</strong>在收到 IP 数据报后，再按<strong>目的网络号</strong> net-id 和<strong>子网号</strong> subnet-id 找到目的子网。</li>
<li>最后就将 IP 数据报直接交付目的主机。</li>
</ul>
<p>划分为三个子网后对外仍是一个网络</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640483420624-image.png"></p>
<blockquote>
<ul>
<li><strong>优点</strong><ol>
<li>减少了 IP 地址的浪费</li>
<li>使网络的组织更加灵活</li>
<li>更便于维护和管理</li>
</ol>
</li>
<li><strong>划分子网纯属一个单位内部的事情，对外部网络透明</strong>，对外仍然表现为没有划分子网的一个网络。</li>
</ul>
</blockquote>
<h3 id="子网掩码"><a href="#子网掩码" class="headerlink" title="子网掩码"></a>子网掩码</h3><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640483430472-image.png"></p>
<blockquote>
<p><strong>(IP 地址) AND (子网掩码) = 网络地址</strong> 重要，下面很多相关知识都会用到</p>
</blockquote>
<p>举例</p>
<p>例子1</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640483438980-image.png"></p>
<blockquote>
<p>下题中，给的子网掩码255.255.255.128中的128表明从主机号部分借用一个比特作为子网号，也就是<strong>将该C类网均分为两个子网，其子网号分别为0和1</strong></p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640483455297-image.png"></p>
<blockquote>
<p>上图可看出，子网掩码255.255.255.128可将C类网218.75.230.0均分为两个子网</p>
</blockquote>
<p>例子2</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640483468060-image.png"></p>
<blockquote>
<p>主要是看子网号有几位，1位就可划分出2^1个子网，2位就可划分出2^2个子网。</p>
<p>子网号怎么看？</p>
<p>32比特的子网掩码可以表明分类IP地址的主机号部分被借用了几个比特作为子网号</p>
<p>解释：先看是A、B、C哪类网，从而确定网络、主机号有几位，子网掩码主机号部分如255.255.255.192这个是C类网，它的主机号是后8位，192写成八位二进制：11000000，前两位11，表示它子网号就有2^2个。即：00、01、10、11</p>
<p>梦回计组嗷~</p>
</blockquote>
<p>考研题：<br><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640485297681-image.png"></p>
<blockquote>
<p>思路如下：</p>
</blockquote>
<blockquote>
<p>1、180开头是B类网，网络号16位，主机号16位。将IP地址的主机号部分转换成二进制形式，将子网掩码中，连续的6个比特1所对应的主机号部分作为子网号。</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640485503303-image.png"></p>
<blockquote>
<p>2、将网络号和子网号保持不变，而将主机号的10个比特全部取0，就可以得到该主机所在子网的网络地址。</p>
<p>写成点分十进制为：180.80.76.0<br><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640485588635-image.png"><br>3、将网络号和子网号保持不变，而将主机号的10个比特全部取1，就可以得到该主机所在子网的广播地址</p>
<p>写成点分十进制为：180.80.79.255<br><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640485684854-image.png"></p>
</blockquote>
<blockquote>
<p>在这俩区间中（180.80.76.0 ~ 180.80.79.255），可以找到答案。</p>
</blockquote>
<p><strong>默认子网掩码</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640483486944-image.png"></p>
<h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640483495990-image.png"></p>
<blockquote>
<ul>
<li>子网掩码是一个网络或一个子网的重要属性。</li>
<li>路由器在和相邻路由器交换路由信息时，必须把自己所在网络（或子网）的子网掩码告诉相邻路由器。</li>
<li>路由器的路由表中的每一个项目，除了要给出目的网络地址外，还必须同时给出该网络的子网掩码。</li>
<li>若一个路由器连接在两个子网上，就拥有两个网络地址和两个子网掩码。</li>
</ul>
</blockquote>
<h2 id="无分类编址的IPv4地址"><a href="#无分类编址的IPv4地址" class="headerlink" title="无分类编址的IPv4地址"></a>无分类编址的IPv4地址</h2><h3 id="为什么使用无分类编址"><a href="#为什么使用无分类编址" class="headerlink" title="为什么使用无分类编址"></a>为什么使用无分类编址</h3><p><strong>无分类域间路由选择 CIDR</strong> (Classless Inter-Domain Routing)。 </p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640486841507-image.png"></p>
<blockquote>
<p><strong>CIDR 最主要的特点</strong></p>
<ul>
<li>CIDR使用各种长度的“<strong>网络前缀</strong>”(network-prefix)来代替分类地址中的网络号和子网号。</li>
<li><strong>IP 地址从三级编址（使用子网掩码）又回到了两级编址</strong>。 </li>
</ul>
</blockquote>
<h3 id="如何使用无分类编址"><a href="#如何使用无分类编址" class="headerlink" title="如何使用无分类编址"></a>如何使用无分类编址</h3><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640486863329-image.png"></p>
<p>举例</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640486871657-image.png"></p>
<h3 id="路由聚合（构造超网）"><a href="#路由聚合（构造超网）" class="headerlink" title="路由聚合（构造超网）"></a>路由聚合（构造超网）</h3><p>存在意义？</p>
<blockquote>
<p>路由器R1与五个网络以及路由器R2直接相连，路由器R1和R2互为相邻路由器，它们周期性地通告自己所知道的路由信息给对方。</p>
<p>若R1将自己直连的这五个网络的路由记录都通告给R2，则R2的路由表会增加5条路由记录。</p>
<p>为了减少路有记录对路由表的占用，采用路由聚合（构造超网）（即找它们共同前缀）的方式。<br><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640486879241-image.png"></p>
</blockquote>
<p>练习：</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640487955743-image.png"></p>
<h3 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h3><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640486886563-image.png"></p>
<h2 id="IPv4地址的应用规划"><a href="#IPv4地址的应用规划" class="headerlink" title="IPv4地址的应用规划"></a>IPv4地址的应用规划</h2><p>给定一个IPv4地址快，如何将其划分成几个更小的地址块，并将这些地址块分配给互联网中不同网络，进而可以给各网络中的主机和路由器接口分配IPv4地址</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640489579592-image.png"></p>
<h3 id="定长的子网掩码FLSM（Fixed-Length-Subnet-Mask）"><a href="#定长的子网掩码FLSM（Fixed-Length-Subnet-Mask）" class="headerlink" title="定长的子网掩码FLSM（Fixed Length Subnet Mask）"></a>定长的子网掩码FLSM（Fixed Length Subnet Mask）</h3><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640488402926-image.png"></p>
<p><strong>划分子网的IPv4就是定长的子网掩码</strong></p>
<p>举例</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640488851899-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640488863501-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640488877218-image.png"></p>
<blockquote>
<p>通过上面步骤分析，就可以从子网1<del>8中任选5个分配给左图中的网络N1</del>N5</p>
<p><strong>采用定长的子网掩码划分，只能划分出2^n个子网，其中n是从主机号部分借用的用来作为子网号的比特数量，每个子网所分配的IP地址数量相同</strong></p>
<p><strong>但是也因为每个子网所分配的IP地址数量相同，不够灵活，容易造成IP地址的浪费</strong></p>
<p>例如：图中N5只需要4个网络地址，但我们只能给它分配32个。</p>
</blockquote>
<h3 id="变长的子网掩码VLSM（Variable-Length-Subnet-Mask）"><a href="#变长的子网掩码VLSM（Variable-Length-Subnet-Mask）" class="headerlink" title="变长的子网掩码VLSM（Variable Length Subnet Mask）"></a>变长的子网掩码VLSM（Variable Length Subnet Mask）</h3><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640489022597-image.png"></p>
<p><strong>无分类编址的IPv4就是变长的子网掩码</strong></p>
<p>举例</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640489040146-image.png"><br>在地址块中给左图所示的网络N1~N5分配子块，分配原则是<strong>每个子块的起点位置不能随意选取，只能选取块大小整数倍的地址作为起点</strong>。建议<strong>先给大的子块分配</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640489051371-image.png"></p>
<hr>
<h1 id="IP数据报的发送和转发过程"><a href="#IP数据报的发送和转发过程" class="headerlink" title="IP数据报的发送和转发过程"></a>IP数据报的发送和转发过程</h1><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640497932862-image.png"></p>
<p>举例</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640497956222-image.png"></p>
<p>源主机如何知道目的主机是否与自己在同一个网络中，是直接交付，还是间接交付？</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640497973189-image.png"></p>
<blockquote>
<p>可以通过<strong>目的地址IP</strong>和<strong>源地址的子网掩码</strong>进行<strong>逻辑与运算</strong>得到<strong>目的网络地址</strong></p>
<ul>
<li>如果<strong>目的网络地址</strong>和<strong>源网络地址</strong> <strong>相同</strong>，就是<strong>在同一个网络</strong>中，属于<strong>直接交付</strong></li>
<li>如果<strong>目的网络地址</strong>和<strong>源网络地址</strong> <strong>不相同</strong>，就<strong>不在同一个网络</strong>中，属于<strong>间接交付</strong>，传输给主机所在网络的<strong>默认网关</strong>（路由器——下图会讲解）,由默认网关帮忙转发</li>
</ul>
</blockquote>
<p>主机C如何知道路由器R的存在？</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640497984707-image.png"></p>
<blockquote>
<p>用户为了让本网络中的主机能和其他网络中的主机进行通信，就必须给其指定本网络的一个路由器的接口，由该路由器帮忙进行转发，<strong>所指定的路由器</strong>，也被称为<strong>默认网关</strong></p>
<p>例如。路由器的接口0的IP地址192.168.0.128作为左边网络的默认网关</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640497997542-image.png"></p>
<blockquote>
<p>主机A会将该IP数据报传输给自己的默认网关，也就是图中所示的路由器接口0</p>
</blockquote>
<p>路由器收到IP数据报后如何转发？</p>
<ul>
<li>检查IP数据报首部是否出错：<ul>
<li>若出错，则直接丢弃该IP数据报并通告源主机</li>
<li>若没有出错，则进行转发</li>
</ul>
</li>
<li>根据IP数据报的目的地址在路由表中查找匹配的条目：<ul>
<li>若找到匹配的条目，则转发给条目中指示的下一跳</li>
<li>若找不到，则丢弃该数据报并通告源主机</li>
</ul>
</li>
</ul>
<p>假设IP数据报首部没有出错，路由器取出IP数据报首部各地址字段的值</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640498035998-image.png"></p>
<p>接下来路由器对该IP数据报进行查表转发</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640498046281-image.png"></p>
<blockquote>
<p>逐条检查路由条目，将目的地址与路由条目中的地址掩码进行逻辑与运算得到目的网络地址，然后与路由条目中的目的网络进行比较，如果相同，则这条路由条目就是匹配的路由条目，按照它的下一跳指示，图中所示的也就是接口1转发该IP数据报</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640498056843-image.png"></p>
<p>路由器是隔离广播域的</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640498134626-image.png"></p>
<p>练习：</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640498157727-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640498227451-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640498367352-image.png"></p>
<p>小结：</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640498391300-image.png"></p>
<hr>
<h1 id="静态路由配置及其可能产生的路由环路问题"><a href="#静态路由配置及其可能产生的路由环路问题" class="headerlink" title="静态路由配置及其可能产生的路由环路问题"></a>静态路由配置及其可能产生的路由环路问题</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640498448485-image.png"></p>
<h2 id="多种情况举例"><a href="#多种情况举例" class="headerlink" title="多种情况举例"></a>多种情况举例</h2><p> <strong>静态路由配置</strong></p>
<p>举例</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640498462419-image.png"></p>
<p><strong>默认路由</strong></p>
<p>举例</p>
<p>默认路由可以被所有网络匹配，但路由匹配有优先级，默认路由是优先级最低的</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640498473675-image.png"></p>
<p><strong>特定主机路由</strong></p>
<p>举例</p>
<p>有时候，我们可以给路由器添加针对某个主机的特定主机路由条目</p>
<p>一般用于网络管理人员对网络的管理和测试</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640501073543-image.png"></p>
<blockquote>
<p>多条路由可选，匹配路由最具体的，也就是最长前缀匹配，找不到时，匹配默认路由。</p>
</blockquote>
<p><strong>静态路由配置错误导致路由环路</strong></p>
<p>举例</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640501438058-image.png"></p>
<p>假设将R2的路由表中第三条目录配置错了下一跳</p>
<p>这导致R2和R3之间产生了路由环路</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640501448219-image.png"></p>
<p><strong>聚合了不存在的网络而导致路由环路</strong></p>
<p>举例</p>
<p>正常情况</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640501459117-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640501539138-image.png"></p>
<p>错误情况</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640501549689-image.png"></p>
<p>解决方法</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640501561471-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640501571088-image.png"></p>
<blockquote>
<p>黑洞路由的下一跳为null0，这是路由器内部的虚拟接口，IP数据报进入它后就被丢弃</p>
</blockquote>
<p><strong>网络故障而导致路由环路</strong></p>
<p>举例</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640501580517-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640501589454-image.png"></p>
<p>解决方法</p>
<p>在R1的路由表中，添加针对该直连网络的黑洞路由。</p>
<p>这样，当R2要转发IP数据报到该网络时，进行查表转发，找到匹配的路由条目，下一跳转发给R1的接口1。R1收到该IP数据报后，进行查表转发，找到匹配的路由条目，为一条黑洞路由，下一跳为虚拟接口null0，因此该IP数据报会进入这个黑洞。</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640501600545-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640501614509-image.png"></p>
<p>假设，一段时间后故障网络恢复了</p>
<p>则R1又自动地得出了其接口0的直连网络的路由条目</p>
<p>并将我们之前人工配置的，针对该直连网络的黑洞路由条目设置为失效状态。</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640501668021-image.png"></p>
<p>假设R1再次检测到其接口0所直连的网络，出现了故障而不可达，则会自动在其路由表中删除该直连网络的路由条目。</p>
<p>并将我们之前人工配置的，针对该直连网络的黑洞路由条目，设置为生效状态。</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640501679622-image.png"></p>
<h2 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h2><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640501692517-image.png"></p>
<hr>
<h1 id="路由选择协议"><a href="#路由选择协议" class="headerlink" title="路由选择协议"></a>路由选择协议</h1><h2 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h2><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640504176232-image.png"></p>
<p><strong>因特网所采用的路由选择协议的主要特点</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640504194636-image.png"></p>
<p><strong>因特网采用分层次的路由选择协议</strong></p>
<ul>
<li><strong>自治系统 AS</strong>：在单一的技术管理下的一组路由器，而这些路由器使用一种 AS 内部的路由选择协议和共同的度量以确定分组在该 AS 内的路由，同时还使用一种 AS 之间的路由选择协议用以确定分组在 AS之间的路由。</li>
</ul>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640504209365-image.png"></p>
<blockquote>
<p>自治系统之间的路由选择简称为域间路由选择，自治系统内部的路由选择简称为域内路由选择</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640504290247-image.png"></p>
<blockquote>
<p>域间路由选择使用外部网关协议EGP这个类别的路由选择协议</p>
<p>域内路由选择使用内部网关协议IGP这个类别的路由选择协议</p>
<p>使用”网关“这个名词，是因为因特网早期的RFC文档中，没有使用”路由器“。现在新的RFC文档中，又改用”路由器“这一名词。</p>
<p>故：<br>外部网关协议EGP可称为：外部路由协议ERP<br>内部网关协议IGP可称为：内部路由协议IRP</p>
</blockquote>
<p><strong>常见的路由选择协议</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640504311934-image.png"></p>
<p><strong>路由器的基本结构</strong></p>
<p>路由器是一种具有多个输入端口，和输出端口的专用计算机，其任务是转发分组</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506060598-image.png"></p>
<p>路由器结构可划分为两大部分：</p>
<p>1、<strong>分组转发部分</strong></p>
<p> 由三部分构成</p>
<ul>
<li><p>交换结构</p>
</li>
<li><p>一组输入端口：</p>
<p>信号从某个输入端口进入路由器</p>
</li>
</ul>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506076797-image.png"></p>
<p>   物理层将信号转换成比特流，送交数据链路层处理</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506086068-image.png"></p>
<p>   数据链路层识别从比特流中识别出帧，去掉帧头和帧尾后，送交网络层处理</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506099124-image.png"></p>
<p>  如果送交网络层的分组是普通待转发的数据分组</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506122179-image.png"></p>
<p>  则根据分组首部中的目的地址进行查表转发</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506157190-image.png"></p>
<p>   若找不到匹配的转发条目，则丢弃该分组，否则，按照匹配条目中所指示的端口进行转发</p>
<ul>
<li><p>一组输出端口</p>
<p>网络层更新数据分组首部中某些字段的值，例如将数据分组的生存时间减1，然后送交数据链路层进行封装</p>
</li>
</ul>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506240762-image.png"></p>
<p>   数据链路层将数据分组封装成帧，交给物理层处理</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506247348-image.png"></p>
<p>   物理层将帧看成比特流将其变换成相应的电信号进行发送</p>
<blockquote>
<p>路由器的各端口还会有输入缓冲区和输出缓冲区</p>
<ul>
<li><p>输入缓冲区用来暂存新进入路由器但还来不及处理的分组</p>
</li>
<li><p>输出缓冲区用来暂存已经处理完毕但还来不及发送的分组</p>
</li>
</ul>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506272010-image.png"></p>
<p><strong>路由器的端口一般都具有输入和输出功能</strong>，这些实例分别给出了输入端口和输出端口是为了更好地演示路由基本工作过程</p>
</blockquote>
<p> 2、<strong>路由选择部分</strong></p>
<ul>
<li><p>路由选择部分的核心构件是路由选择处理机，它的任务是根据所使用的路由选择协议。周期性地与其他路由器 进行路由信息的交互，来更新路由表</p>
<p>如果送交给输入端口的网络层的分组是路由器之间交换路由信息的路由报文，则把这种分组送交给路由选择处理机</p>
</li>
</ul>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506315904-image.png"></p>
<p>   路由选择处理机根据分组的内容来更新自己的<strong>路由表</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640505957126-image.png"></p>
<p>   路由选择处理机还会周期性地给其他路由器发送自己所知道的路由信息</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506373840-image.png"></p>
<h2 id="路由信息协议RIP"><a href="#路由信息协议RIP" class="headerlink" title="路由信息协议RIP"></a>路由信息协议RIP</h2><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506648635-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506674809-image.png"></p>
<p><strong>RIP的基本工作过程</strong></p>
<p>举例</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506690642-image.png"></p>
<p><strong>RIP的路由条目的更新规则</strong></p>
<p>举例1</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506701216-image.png"></p>
<blockquote>
<p>路由器C的表到达各目的网络的下一跳都记为问号，可以理解为路由器D并不需要关心路由器C的这些内容</p>
<p>假设路由器C的RIP更新报文发送周期到了，则路由器C将自己路由表中的相关路由信息封装到RIP更新报文中发送给路由器D</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506712548-image.png"></p>
<blockquote>
<p>路由器C能到达这些网络，说明路由器C的相邻路由器也能到达，只是比路由器C的距离大1，于是路由器D现在可以根据改造好的路由表，来更新自己先前的路由表了。</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506721860-image.png"></p>
<p>对于上图中的N2，因为原本下一跳是到C，而C的拓扑结构改变了（原来的那条路可能没了），现在到C不能再那么短的距离了，所以需要更新。</p>
<p>举例2：请给出路由器B更新后的路由表</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506729743-image.png"></p>
<p>练习：</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640509033465-image.png"></p>
<p><strong>RIP存在“坏消息传播得慢”的问题</strong></p>
<p>假设R2的更新周期先到时，也就是R2的这条路由信息先到达R1。<br><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506747735-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506757581-image.png"></p>
<p>解决方法</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506768455-image.png"></p>
<blockquote>
<p>但是，这些方法也不能完全解决“坏消息传播得慢”的问题，这是距离向量的本质决定</p>
</blockquote>
<p>练习：</p>
<p>题目中的”检测“意为第一个探测到，而不是说更新路由表后发现不可达。</p>
<p>根据题目所给“R3检测到网络201.1.2.0/25不可达”可知，R3与该网络是直连的。</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640509134152-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640509280549-image.png"><br>当R3检测到该故障时，将自己到达该网络的路由条目中的距离修改为16，表示该网络不可达，并向R2发送关于这条路由条目的通告。R2收到后，更新自己相应的路由条目，将距离修改为16</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640509791007-image.png"></p>
<p>最后，根据题目”则R2更新后“这句话可知，R1给R2发送了关于该路由条目的RIP更新报文（R1到了周期性传送时间了）。而R2听信了该谣言，误认为到达该目的网络可以通过R1的转发，距离为3</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640509836232-image.png"></p>
<p><strong>总结</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640506779271-image.png"></p>
<blockquote>
<p>RIP 协议的优缺点</p>
<p>优点：</p>
<ol>
<li>实现简单，开销较小。</li>
</ol>
<p>缺点：</p>
<ol>
<li><p>RIP 限制了网络的规模，它能使用的最大距离为 15（16 表示不可达）。</p>
</li>
<li><p>路由器之间交换的路由信息是路由器中的完整路由表，因而随着网络规模的扩大，开销也就增加。</p>
</li>
<li><p>“坏消息传播得慢”，使更新过程的收敛时间过长。</p>
</li>
</ol>
</blockquote>
<h2 id="开放最短路径优先OSPF"><a href="#开放最短路径优先OSPF" class="headerlink" title="开放最短路径优先OSPF"></a>开放最短路径优先OSPF</h2><p><strong>开放最短路径优先 OSPF (Open Shortest Path First)</strong></p>
<p><strong>注意</strong>：OSPF 只是一个协议的名字，它并不表示其他的路由选择协议不是“最短路径优先”。</p>
<p><strong>概念</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640511652453-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640511665934-image.png"></p>
<p><strong>问候（Hello）分组</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640511677729-image.png"></p>
<blockquote>
<p>IP数据报首部中协议号字段的取值应为89，来表明IP数据报的数据载荷为OSPF分组</p>
</blockquote>
<p><strong>发送链路状态通告LSA</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640511688239-image.png"></p>
<blockquote>
<p>洪泛法有点类似于广播，就是从一个接口进来，从其他剩余所有接口出去</p>
</blockquote>
<p><strong>链路状态数据库同步</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640511702036-image.png"></p>
<p><strong>使用SPF算法计算出各自路由器到达其他路由器的最短路径</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640511719730-image.png"></p>
<p><strong>OSPF五种分组类型</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640511727824-image.png"></p>
<p><strong>OSPF的基本工作过程</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640511737787-image.png"></p>
<p>相邻路由器之间周期性发送问候分组，以便建立和维护邻居关系，建立邻居关系后，给邻居路由器发送数据库描述分组。也就是将自己链路状态数据库中的所有链路状态项目的摘要信息，发送给邻居路由器。</p>
<p>例如，R1收到R2的数据库描述分组后，发现自己缺少其中的某些链路状态项目，于是就给R2发送链路状态请求分组。</p>
<p>R2收到后，将R1缺少的链路状态项目的详细信息，封装在链路状态更新分组中发送给R1，R1收到后，将这些所缺少的链路状态项目的详细信息，添加到自己的链路状态数据库中，并给R2发送链路状态确认分组。</p>
<p>需要说明的是，R2也可以向R1请求自己缺少的链路状态项目的详细信息，这里不再赘述。</p>
<p>最终，R1和R2的链路状态数据库将达到一致，也就是链路状态数据库达到同步。</p>
<p>每三十分钟或链路状态发生变化时，路由器都会发送链路状态更新分组。收到该分组的其他路由器将洪泛转发该分组，并给该路由器发回链路状态确认分组。这又称为新情况下的链路状态数据库同步。</p>
<p><strong>OSPF在多点接入网络中路由器邻居关系建立</strong></p>
<p>如果不采用其他机制，将会产生大量的多播分组</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640511750144-image.png"></p>
<blockquote>
<p>若DR出现问题，则由BDR顶替DR</p>
</blockquote>
<p><strong>为了使OSPF能够用于规模很大的网络，OSPF把一个自治系统再划分为若干个更小的范围，叫做区域（Area）</strong></p>
<ul>
<li><p>在该自治系统内，所有路由器都使用OSPF协议，OSPF将该自治系统再划分成4个更小的区域</p>
</li>
<li><p>每个区域都有一个32比特的区域标识符</p>
</li>
<li><p>主干区域的区域标识符必须为0，主干区域用于连通其他区域</p>
</li>
<li><p>其他区域的区域标识符不能为0且不相同</p>
</li>
<li><p>每个区域一般不应包含路由器超过200个</p>
</li>
<li><p>划分区域的好处就是，利用洪泛法交换链路状态信息局限于每一个区域而不是自治系统，这样减少整个网络上的通信量</p>
</li>
</ul>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640511761048-image.png"></p>
<p>如果路由器的所有接口都在同一个区域内，则该路由器称为<strong>区域内路由器IR：R1、R2、R8、R9</strong></p>
<p><strong>区域边界路由器ABR</strong>，它的一个接口用于连接自身所在区域，另一个接口用于连接主干区域：<strong>R3、R4、R7</strong></p>
<p>主干区域内的路由器，称为<strong>主干路由器BB：R3、R4、R5、R6、R7</strong></p>
<p>在主干区域内还要有一个路由器，专门和本自治系统外的其他自治系统交换路由信息，其称为<strong>自治系统边界路由器：R6</strong></p>
<p>在本例中：</p>
<p>区域边界路由器R3，向主干区域发送自己所在区域1的链路状态通告；向自己所在区域发送区域0，2，3的链路状态通告LSA。</p>
<p>区域边界路由器R4，向主干区域发送自己所在区域2的链路状态通告；向自己所在区域发送区域0，1，3的链路状态通告。</p>
<p>区域边界路由器R7，向主干区域发送自己所在区域3的链路状态通告；向自己所在区域发送区域0，1，2的链路状态通告。</p>
<p><strong>采用分层次划分区域的方法，虽然使交换信息的种类增多了，同时也使OSPF协议更加复杂了，但这样做，却能使每一个区域内部，交换路由信息的通信量大大减小。因而使OSPF协议能够用于规模很大的自治系统中。</strong></p>
<p><strong>总结</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640511771635-image.png"></p>
<h2 id="边界网关协议BGP"><a href="#边界网关协议BGP" class="headerlink" title="边界网关协议BGP"></a>边界网关协议BGP</h2><p>BGP（Border Gateway Protocol） 是<strong>不同自治系统的路由器之间</strong>交换路由信息的协议</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640516140680-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640516301863-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640516316977-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640516444076-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640516347988-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640516359608-image.png"><br><strong>在BGP协议刚刚运行时，BGP的邻站交换整个BGP路由表，但以后只需要在发生变化时更新有变化的部，这样做对节省网络带宽和减少路由器的处理开销都有好处。</strong></p>
<p>练习：</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640517216782-image.png"></p>
<h2 id="直接封装RIP、OSPF和BGP报文的协议"><a href="#直接封装RIP、OSPF和BGP报文的协议" class="headerlink" title="直接封装RIP、OSPF和BGP报文的协议"></a>直接封装RIP、OSPF和BGP报文的协议</h2><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640517254310-image.png"></p>
<p><strong>总结</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640516369655-image.png"></p>
<hr>
<h1 id="IPv4数据报的首部格式"><a href="#IPv4数据报的首部格式" class="headerlink" title="IPv4数据报的首部格式"></a>IPv4数据报的首部格式</h1><h2 id="各字段的作用"><a href="#各字段的作用" class="headerlink" title="各字段的作用"></a>各字段的作用</h2><ul>
<li>一个 IP 数据报由<strong>首部</strong>和<strong>数据</strong>两部分组成。</li>
<li><strong>首部的前一部分是固定长度，共 20 字节，是所有 IP 数据报必须具有的。</strong></li>
<li>在首部的固定部分的后面是一些可选字段，其长度是可变的。</li>
</ul>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640521549803-image.png"></p>
<p>图中的每一行都由32个比特（也就是4个字节）构成，每个小格子称为字段或者域，每个字段或某些字段的组合用来表达IP协议的相关功能</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640521627493-image.png"></p>
<blockquote>
<p><strong>IP数据报的首部长度一定是4字节的整数倍</strong></p>
<p>因为首部中的可选字段的长度从1个字节到40个字节不等，那么，当20字节的固定部分加上1到40个字节长度不等的可变部分，<strong>会造成首部长度不是4字节整数倍时，就用取值为全0的填充字段填充相应个字节</strong>，以确保IP数据报的首部长度是4字节的整数倍</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640521890173-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640521903229-image.png"></p>
<p><strong>对IPv4数据报进行分片</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640521917328-image.png"><br>其中，片偏移字段中0/8除以8的原因是：片偏移字段以8字节为单位。</p>
<pre><code>    现在假定分片2的IP数据报经过某个网络时还需要进行分片
</code></pre>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640521990714-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640522001939-image.png"></p>
<p>当首部中，协议字段的取值为1时，表明数据部分时ICMP报文，也就是用ICMP协议封装的协议数据单元。</p>
<p>当首部中，协议字段的取值为6时，表明数据部分时TCP报文，也就是用TCP协议封装的协议数据单元。<br><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640522022596-image.png"></p>
<p><code>因特网检验和</code>的检错能力不强，好处是简单，处理起来快。</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640522035712-image.png"></p>
<p>练习：</p>
<p>第一题：<br><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640523407016-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640523446972-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640523505333-image.png"></p>
<p>第二题：</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640523680370-image.png"><br>IP分组要封装成以太网帧才能发送，在IP分组头中，目的IP地址字段前还有16个字节的内容；在以太网帧中，数据载荷前还有14字节的内容。因此可知，在以太网帧中，从第31个字节开始的4个字节，实际上就是目的IP的内容。</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640523961116-image.png"><br>从图中可知，主机的默认网关就是路由器R，主机会将Web请求发送给默认网关，由默认网关将Web请求转发到因特网。</p>
<p>因此，以太网帧头中的目的MAC地址字段，封装的就是默认网关的MAC地址</p>
<p>如下图所示：</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640525620901-image.png"><br>（4）</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640526159936-image.png"></p>
<h2 id="总结-5"><a href="#总结-5" class="headerlink" title="总结"></a>总结</h2><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640522056482-image.png"></p>
<hr>
<h1 id="网际控制报文协议ICMP"><a href="#网际控制报文协议ICMP" class="headerlink" title="网际控制报文协议ICMP"></a>网际控制报文协议ICMP</h1><h2 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h2><p>架构IP网络时需要特别注意两点：</p>
<ul>
<li>确认网络是否正常工作</li>
<li>遇到异常时进行问题诊断</li>
</ul>
<p><strong>而ICMP就是实现这些问题的协议</strong></p>
<p>ICMP的主要功能包括：</p>
<ul>
<li>确认IP包是否成功送达目标地址</li>
<li>通知在发送过程当中IP包被废弃的具体原因</li>
<li>改善网络设置等</li>
</ul>
<p><strong>有了这些功能以后，就可以获得网络是否正常，设置是否有误以及设备有何异常等信息，从而便于进行网络上的问题诊断</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640526315889-image.png"></p>
<p><strong>ICMP 不是高层协议（看起来好像是高层协议，因为 ICMP 报文是装在 IP 数据报中，作为其中的数据部分），而是 IP 层的协议</strong></p>
<p>ICMP 报文的格式</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640526560581-image.png"></p>
<h2 id="ICMP差错报告报文"><a href="#ICMP差错报告报文" class="headerlink" title="ICMP差错报告报文"></a>ICMP差错报告报文</h2><h3 id="终点不可达"><a href="#终点不可达" class="headerlink" title="终点不可达"></a>终点不可达</h3><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640526364150-image.png"></p>
<h3 id="源点抑制"><a href="#源点抑制" class="headerlink" title="源点抑制"></a>源点抑制</h3><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640526386633-image.png"></p>
<h3 id="时间超过"><a href="#时间超过" class="headerlink" title="时间超过"></a>时间超过</h3><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640526398387-image.png"></p>
<h3 id="参数问题"><a href="#参数问题" class="headerlink" title="参数问题"></a>参数问题</h3><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640526414096-image.png"></p>
<h3 id="改变路由（重定向）"><a href="#改变路由（重定向）" class="headerlink" title="改变路由（重定向）"></a>改变路由（重定向）</h3><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640526463991-image.png"></p>
<h3 id="不应发送ICMP差错报告报文情况"><a href="#不应发送ICMP差错报告报文情况" class="headerlink" title="不应发送ICMP差错报告报文情况"></a>不应发送ICMP差错报告报文情况</h3><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640526475285-image.png"></p>
<p>练习：</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640526763689-image.png"></p>
<h2 id="ICMP应用举例"><a href="#ICMP应用举例" class="headerlink" title="ICMP应用举例"></a>ICMP应用举例</h2><h3 id="分组网间探测PING（Packet-InterNet-Groper）"><a href="#分组网间探测PING（Packet-InterNet-Groper）" class="headerlink" title="分组网间探测PING（Packet InterNet Groper）"></a>分组网间探测PING（Packet InterNet Groper）</h3><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640526487871-image.png"></p>
<h3 id="跟踪路由（traceroute）"><a href="#跟踪路由（traceroute）" class="headerlink" title="跟踪路由（traceroute）"></a>跟踪路由（traceroute）</h3><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640526841031-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640526852962-image.png"></p>
<p><strong>tracert命令的实现原理</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640526867591-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640526876348-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640526887428-image.png"></p>
<p>以最后一个为例，H1发送一个封装有ICMP回送请求报文的IP数据报</p>
<p>其首部中生存时间字段TTL的值被设置为3，经过R1和R2的转发后，该数据报到达主机H2，其生存时间减少为1</p>
<p>H2解析该数据报，发现其内部封装的是ICMP回送请求报文，于是就给H1发送封装有ICMP回送请求回答报文的IP数据报。</p>
<p>这样，H1就知道已经跟踪到路径的最后一站，也就是目的主机H2</p>
<h2 id="总结-6"><a href="#总结-6" class="headerlink" title="总结"></a>总结</h2><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640526897832-image.png"></p>
<hr>
<h1 id="虚拟专用网VPN与网络地址转换NAT"><a href="#虚拟专用网VPN与网络地址转换NAT" class="headerlink" title="虚拟专用网VPN与网络地址转换NAT"></a>虚拟专用网VPN与网络地址转换NAT</h1><h2 id="虚拟专用网VPN（Virtual-Private-Network）"><a href="#虚拟专用网VPN（Virtual-Private-Network）" class="headerlink" title="虚拟专用网VPN（Virtual Private Network）"></a>虚拟专用网VPN（Virtual Private Network）</h2><ul>
<li>由于 <strong>IP 地址的紧缺</strong>，一个机构能够申请到的IP地址数往往远小于本机构所拥有的主机数。</li>
<li>考虑到<strong>互联网并不很安全</strong>，一个机构内也并不需要把所有的主机接入到外部的互联网。</li>
<li>假定在一个机构内部的计算机通信也是采用 TCP/IP 协议，那么从原则上讲，对于这些仅在<strong>机构内部使用</strong>的计算机就可以由本机构<strong>自行分配其 IP 地址</strong>。</li>
</ul>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640527798349-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640527945294-image.png"></p>
<blockquote>
<p>上图是因特网数字分配机构IANA官网查看IPv4地址空间中特殊地址的分配方案</p>
<p>用粉红色标出来的地址就是无需申请的、可自由分配的专用地址，或称私有地址</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640528399297-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640528486471-image.png"></p>
<blockquote>
<p><strong>私有地址只能用于一个机构的内部通信，而不能用于和因特网上的主机通信</strong></p>
<p><strong>私有地址只能用作本地地址而不能用作全球地址</strong></p>
<p><strong>因特网中所有路由器对目的地址是私有地址的IP数据报一律不进行转发</strong></p>
<p><strong>本地地址与全球地址</strong></p>
<ul>
<li><strong>本地地址</strong>——仅在机构内部使用的 IP 地址，可以由本机构自行分配，而不需要向互联网的管理机构申请。</li>
<li><strong>全球地址</strong>——全球唯一的 IP 地址，必须向互联网的管理机构申请。 </li>
<li><strong>问题</strong>：在内部使用的本地地址就有可能和互联网中某个 IP 地址重合，这样就会出现地址的二义性问题。</li>
</ul>
</blockquote>
<p>所以部门A和部门B至少需要一个 路由器具有合法的全球IP地址，这样各自的专用网才能利用公用的因特网进行通信</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640528126382-image.png"></p>
<p>部门A向部门B发送数据流程</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640528119910-image.png"></p>
<blockquote>
<p>两个专用网内的主机间发送的数据报是通过了公用的因特网，但在效果上就好像是在本机构的专用网上传送一样</p>
<p>数据报在因特网中可能要经过多个网络和路由器，但从逻辑上看，R1和R2之间好像是一条直通的点对点链路</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640528150396-image.png"></p>
<p>因此也被称为IP隧道技术</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640528176255-image.png"></p>
<h2 id="网络地址转换NAT（Network-Address-Translation）"><a href="#网络地址转换NAT（Network-Address-Translation）" class="headerlink" title="网络地址转换NAT（Network Address Translation）"></a>网络地址转换NAT（Network Address Translation）</h2><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640528186360-image.png"></p>
<p>举例</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640528197820-image.png"></p>
<blockquote>
<p>使用私有地址的主机，如何才能与因特网上使用全球IP地址的主机进行通信？</p>
<p>这需要在专用网络连接到因特网的路由器上安装NAT软件</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640528206978-image.png"></p>
<blockquote>
<p>专有NAT软件的路由器叫做NAT路由器</p>
<p>它至少有一个有效的外部全球IP地址</p>
<p>这样，所有使用私有地址的主机在和外界通信时，都要在NAT路由器上将其私有地址转换为全球IP地址</p>
</blockquote>
<p>假设，使用私有地址的主机要给因特网上使用全球IP地址的另一台主机发送IP数据报</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640528216603-image.png"></p>
<p>因特网上的这台主机给源主机发回数据报</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640528225820-image.png"></p>
<p>当专用网中的这两台使用私有地址的主机都要给因特网使用全球地址的另一台主机发送数据报时，在NAT路由器的NAT转换表中就会产生两条记录，分别记录两个私有地址与全球地址的对应关系</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640528238068-image.png"></p>
<p>这种基本转换存在一个问题</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640528248721-image.png"></p>
<p>解决方法</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640528257897-image.png"></p>
<blockquote>
<p>我们现在用的很多家用路由器都是这种NART路由器</p>
</blockquote>
<p>内网主机与外网主机的通信，是否能由外网主机首先发起？</p>
<p>否定</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640528273908-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640528285816-image.png"></p>
<h2 id="总结-7"><a href="#总结-7" class="headerlink" title="总结"></a>总结</h2><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-26/1640528306532-image.png"></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%AE%A1%E7%BD%91/">计网</a></div><div class="post_share"><div class="social-share" data-image="/img/mn8.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/12/26/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-5%E8%BF%90%E8%BE%93%E5%B1%82/"><img class="prev-cover" src="/img/mn9.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">计算机网络-5运输层</div></div></a></div><div class="next-post pull-right"><a href="/2021/12/25/2022%E5%B9%B4%E5%85%A8%E5%9B%BD%E7%A0%94%E7%A9%B6%E7%94%9F%E5%85%A5%E5%AD%A6%E8%80%83%E8%AF%95%E7%AC%AC%E4%B8%80%E5%A4%A9/"><img class="next-cover" src="/img/kyjy.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">2022年全国研究生入学考试第一天</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/12/22/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-1%E6%A6%82%E8%BF%B0/" title="计算机网络-1概述"><img class="cover" src="/img/mn.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-22</div><div class="title">计算机网络-1概述</div></div></a></div><div><a href="/2021/12/23/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-2%E7%89%A9%E7%90%86%E5%B1%82/" title="计算机网络-2物理层"><img class="cover" src="/img/mn5.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-23</div><div class="title">计算机网络-2物理层</div></div></a></div><div><a href="/2021/12/26/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-5%E8%BF%90%E8%BE%93%E5%B1%82/" title="计算机网络-5运输层"><img class="cover" src="/img/mn9.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-26</div><div class="title">计算机网络-5运输层</div></div></a></div><div><a href="/2021/12/28/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-6%E5%BA%94%E7%94%A8%E5%B1%82/" title="计算机网络-6应用层"><img class="cover" src="/img/mn11.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-28</div><div class="title">计算机网络-6应用层</div></div></a></div><div><a href="/2021/12/23/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E4%B9%A0%E9%A2%98%E8%AF%BE/" title="计算机网络习题课"><img class="cover" src="/img/mn2.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-23</div><div class="title">计算机网络习题课</div></div></a></div><div><a href="/2021/12/24/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-3%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/" title="计算机网络-3数据链路层"><img class="cover" src="/img/mn10.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-24</div><div class="title">计算机网络-3数据链路层</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/me.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">马厚煜</div><div class="author-info__description">为者常成，行者常至</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">16</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/r2peak"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/r2peak" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">Start it from the bottom</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">网络层概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.2.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82%E6%8F%90%E4%BE%9B%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.</span> <span class="toc-text">网络层提供的两种服务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E8%BF%9E%E6%8E%A5%E7%9A%84%E8%99%9A%E7%94%B5%E8%B7%AF%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.1.</span> <span class="toc-text">面向连接的虚电路服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E8%BF%9E%E6%8E%A5%E7%9A%84%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.2.</span> <span class="toc-text">无连接的数据报服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E7%94%B5%E8%B7%AF%E6%9C%8D%E5%8A%A1%E4%B8%8E%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">2.3.</span> <span class="toc-text">虚电路服务与数据报服务的对比</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#IPv4"><span class="toc-number">3.</span> <span class="toc-text">IPv4</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">3.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%B1%BB%E7%BC%96%E5%88%B6%E7%9A%84IPv4%E5%9C%B0%E5%9D%80"><span class="toc-number">3.2.</span> <span class="toc-text">分类编制的IPv4地址</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B-1"><span class="toc-number">3.2.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-number">3.2.2.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91%E7%9A%84IPv4%E5%9C%B0%E5%9D%80"><span class="toc-number">3.3.</span> <span class="toc-text">划分子网的IPv4地址</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91"><span class="toc-number">3.3.1.</span> <span class="toc-text">为什么要划分子网</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91"><span class="toc-number">3.3.2.</span> <span class="toc-text">如何划分子网</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81"><span class="toc-number">3.3.3.</span> <span class="toc-text">子网掩码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-number">3.3.4.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E5%88%86%E7%B1%BB%E7%BC%96%E5%9D%80%E7%9A%84IPv4%E5%9C%B0%E5%9D%80"><span class="toc-number">3.4.</span> <span class="toc-text">无分类编址的IPv4地址</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E6%97%A0%E5%88%86%E7%B1%BB%E7%BC%96%E5%9D%80"><span class="toc-number">3.4.1.</span> <span class="toc-text">为什么使用无分类编址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E6%97%A0%E5%88%86%E7%B1%BB%E7%BC%96%E5%9D%80"><span class="toc-number">3.4.2.</span> <span class="toc-text">如何使用无分类编址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E8%81%9A%E5%90%88%EF%BC%88%E6%9E%84%E9%80%A0%E8%B6%85%E7%BD%91%EF%BC%89"><span class="toc-number">3.4.3.</span> <span class="toc-text">路由聚合（构造超网）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-3"><span class="toc-number">3.4.4.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IPv4%E5%9C%B0%E5%9D%80%E7%9A%84%E5%BA%94%E7%94%A8%E8%A7%84%E5%88%92"><span class="toc-number">3.5.</span> <span class="toc-text">IPv4地址的应用规划</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E9%95%BF%E7%9A%84%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81FLSM%EF%BC%88Fixed-Length-Subnet-Mask%EF%BC%89"><span class="toc-number">3.5.1.</span> <span class="toc-text">定长的子网掩码FLSM（Fixed Length Subnet Mask）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%98%E9%95%BF%E7%9A%84%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81VLSM%EF%BC%88Variable-Length-Subnet-Mask%EF%BC%89"><span class="toc-number">3.5.2.</span> <span class="toc-text">变长的子网掩码VLSM（Variable Length Subnet Mask）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#IP%E6%95%B0%E6%8D%AE%E6%8A%A5%E7%9A%84%E5%8F%91%E9%80%81%E5%92%8C%E8%BD%AC%E5%8F%91%E8%BF%87%E7%A8%8B"><span class="toc-number">4.</span> <span class="toc-text">IP数据报的发送和转发过程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE%E5%8F%8A%E5%85%B6%E5%8F%AF%E8%83%BD%E4%BA%A7%E7%94%9F%E7%9A%84%E8%B7%AF%E7%94%B1%E7%8E%AF%E8%B7%AF%E9%97%AE%E9%A2%98"><span class="toc-number">5.</span> <span class="toc-text">静态路由配置及其可能产生的路由环路问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">5.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%A7%8D%E6%83%85%E5%86%B5%E4%B8%BE%E4%BE%8B"><span class="toc-number">5.2.</span> <span class="toc-text">多种情况举例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-4"><span class="toc-number">5.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9%E5%8D%8F%E8%AE%AE"><span class="toc-number">6.</span> <span class="toc-text">路由选择协议</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-1"><span class="toc-number">6.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E4%BF%A1%E6%81%AF%E5%8D%8F%E8%AE%AERIP"><span class="toc-number">6.2.</span> <span class="toc-text">路由信息协议RIP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E6%94%BE%E6%9C%80%E7%9F%AD%E8%B7%AF%E5%BE%84%E4%BC%98%E5%85%88OSPF"><span class="toc-number">6.3.</span> <span class="toc-text">开放最短路径优先OSPF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BE%B9%E7%95%8C%E7%BD%91%E5%85%B3%E5%8D%8F%E8%AE%AEBGP"><span class="toc-number">6.4.</span> <span class="toc-text">边界网关协议BGP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%B0%81%E8%A3%85RIP%E3%80%81OSPF%E5%92%8CBGP%E6%8A%A5%E6%96%87%E7%9A%84%E5%8D%8F%E8%AE%AE"><span class="toc-number">6.5.</span> <span class="toc-text">直接封装RIP、OSPF和BGP报文的协议</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#IPv4%E6%95%B0%E6%8D%AE%E6%8A%A5%E7%9A%84%E9%A6%96%E9%83%A8%E6%A0%BC%E5%BC%8F"><span class="toc-number">7.</span> <span class="toc-text">IPv4数据报的首部格式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%84%E5%AD%97%E6%AE%B5%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">7.1.</span> <span class="toc-text">各字段的作用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-5"><span class="toc-number">7.2.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E9%99%85%E6%8E%A7%E5%88%B6%E6%8A%A5%E6%96%87%E5%8D%8F%E8%AE%AEICMP"><span class="toc-number">8.</span> <span class="toc-text">网际控制报文协议ICMP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5-1"><span class="toc-number">8.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ICMP%E5%B7%AE%E9%94%99%E6%8A%A5%E5%91%8A%E6%8A%A5%E6%96%87"><span class="toc-number">8.2.</span> <span class="toc-text">ICMP差错报告报文</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%88%E7%82%B9%E4%B8%8D%E5%8F%AF%E8%BE%BE"><span class="toc-number">8.2.1.</span> <span class="toc-text">终点不可达</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BA%90%E7%82%B9%E6%8A%91%E5%88%B6"><span class="toc-number">8.2.2.</span> <span class="toc-text">源点抑制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E8%B6%85%E8%BF%87"><span class="toc-number">8.2.3.</span> <span class="toc-text">时间超过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E9%97%AE%E9%A2%98"><span class="toc-number">8.2.4.</span> <span class="toc-text">参数问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%B9%E5%8F%98%E8%B7%AF%E7%94%B1%EF%BC%88%E9%87%8D%E5%AE%9A%E5%90%91%EF%BC%89"><span class="toc-number">8.2.5.</span> <span class="toc-text">改变路由（重定向）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%BA%94%E5%8F%91%E9%80%81ICMP%E5%B7%AE%E9%94%99%E6%8A%A5%E5%91%8A%E6%8A%A5%E6%96%87%E6%83%85%E5%86%B5"><span class="toc-number">8.2.6.</span> <span class="toc-text">不应发送ICMP差错报告报文情况</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ICMP%E5%BA%94%E7%94%A8%E4%B8%BE%E4%BE%8B"><span class="toc-number">8.3.</span> <span class="toc-text">ICMP应用举例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E7%BD%91%E9%97%B4%E6%8E%A2%E6%B5%8BPING%EF%BC%88Packet-InterNet-Groper%EF%BC%89"><span class="toc-number">8.3.1.</span> <span class="toc-text">分组网间探测PING（Packet InterNet Groper）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%9F%E8%B8%AA%E8%B7%AF%E7%94%B1%EF%BC%88traceroute%EF%BC%89"><span class="toc-number">8.3.2.</span> <span class="toc-text">跟踪路由（traceroute）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-6"><span class="toc-number">8.4.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E4%B8%93%E7%94%A8%E7%BD%91VPN%E4%B8%8E%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2NAT"><span class="toc-number">9.</span> <span class="toc-text">虚拟专用网VPN与网络地址转换NAT</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E4%B8%93%E7%94%A8%E7%BD%91VPN%EF%BC%88Virtual-Private-Network%EF%BC%89"><span class="toc-number">9.1.</span> <span class="toc-text">虚拟专用网VPN（Virtual Private Network）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2NAT%EF%BC%88Network-Address-Translation%EF%BC%89"><span class="toc-number">9.2.</span> <span class="toc-text">网络地址转换NAT（Network Address Translation）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-7"><span class="toc-number">9.3.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/12/30/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C1-6%E5%90%88%E9%9B%86/" title="计算机网络1-6合集"><img src="/img/dobetter.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机网络1-6合集"/></a><div class="content"><a class="title" href="/2021/12/30/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C1-6%E5%90%88%E9%9B%86/" title="计算机网络1-6合集">计算机网络1-6合集</a><time datetime="2021-12-30T14:48:31.000Z" title="发表于 2021-12-30 22:48:31">2021-12-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/12/28/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-6%E5%BA%94%E7%94%A8%E5%B1%82/" title="计算机网络-6应用层"><img src="/img/mn11.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机网络-6应用层"/></a><div class="content"><a class="title" href="/2021/12/28/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-6%E5%BA%94%E7%94%A8%E5%B1%82/" title="计算机网络-6应用层">计算机网络-6应用层</a><time datetime="2021-12-28T13:52:31.000Z" title="发表于 2021-12-28 21:52:31">2021-12-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/12/26/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-5%E8%BF%90%E8%BE%93%E5%B1%82/" title="计算机网络-5运输层"><img src="/img/mn9.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机网络-5运输层"/></a><div class="content"><a class="title" href="/2021/12/26/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-5%E8%BF%90%E8%BE%93%E5%B1%82/" title="计算机网络-5运输层">计算机网络-5运输层</a><time datetime="2021-12-26T13:14:31.000Z" title="发表于 2021-12-26 21:14:31">2021-12-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/12/25/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-4%E7%BD%91%E7%BB%9C%E5%B1%82/" title="计算机网络-4网络层"><img src="/img/mn8.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机网络-4网络层"/></a><div class="content"><a class="title" href="/2021/12/25/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-4%E7%BD%91%E7%BB%9C%E5%B1%82/" title="计算机网络-4网络层">计算机网络-4网络层</a><time datetime="2021-12-25T13:14:31.000Z" title="发表于 2021-12-25 21:14:31">2021-12-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/12/25/2022%E5%B9%B4%E5%85%A8%E5%9B%BD%E7%A0%94%E7%A9%B6%E7%94%9F%E5%85%A5%E5%AD%A6%E8%80%83%E8%AF%95%E7%AC%AC%E4%B8%80%E5%A4%A9/" title="2022年全国研究生入学考试第一天"><img src="/img/kyjy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2022年全国研究生入学考试第一天"/></a><div class="content"><a class="title" href="/2021/12/25/2022%E5%B9%B4%E5%85%A8%E5%9B%BD%E7%A0%94%E7%A9%B6%E7%94%9F%E5%85%A5%E5%AD%A6%E8%80%83%E8%AF%95%E7%AC%AC%E4%B8%80%E5%A4%A9/" title="2022年全国研究生入学考试第一天">2022年全国研究生入学考试第一天</a><time datetime="2021-12-25T00:08:26.000Z" title="发表于 2021-12-25 08:08:26">2021-12-25</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 By 马厚煜</div><div class="footer_custom_text">Hi, welcome to my blog!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>