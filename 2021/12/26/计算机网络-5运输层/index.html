<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>计算机网络-5运输层 | Road To Peak</title><meta name="keywords" content="计网"><meta name="author" content="马厚煜"><meta name="copyright" content="马厚煜"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="运输层概述概念进程之间的通信   从通信和信息处理的角度看，运输层向它上面的应用层提供通信服务，它属于面向通信部分的最高层，同时也是用户功能中的最低层。 当网络的边缘部分中的两个主机使用网络的核心部分的功能进行端到端的通信时，只有位于网络边缘部分的主机的协议栈才有运输层，而网络核心部分中的路由器在转发分组时都只用到三层（到网络层）的功能。    进程之间通信流程  “逻辑通信”是指运输层之间的通信">
<meta property="og:type" content="article">
<meta property="og:title" content="计算机网络-5运输层">
<meta property="og:url" content="http://example.com/2021/12/26/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-5%E8%BF%90%E8%BE%93%E5%B1%82/index.html">
<meta property="og:site_name" content="Road To Peak">
<meta property="og:description" content="运输层概述概念进程之间的通信   从通信和信息处理的角度看，运输层向它上面的应用层提供通信服务，它属于面向通信部分的最高层，同时也是用户功能中的最低层。 当网络的边缘部分中的两个主机使用网络的核心部分的功能进行端到端的通信时，只有位于网络边缘部分的主机的协议栈才有运输层，而网络核心部分中的路由器在转发分组时都只用到三层（到网络层）的功能。    进程之间通信流程  “逻辑通信”是指运输层之间的通信">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/mn9.png">
<meta property="article:published_time" content="2021-12-26T13:14:31.000Z">
<meta property="article:modified_time" content="2021-12-28T11:51:09.741Z">
<meta property="article:author" content="马厚煜">
<meta property="article:tag" content="计网">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/mn9.png"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="http://example.com/2021/12/26/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-5%E8%BF%90%E8%BE%93%E5%B1%82/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '计算机网络-5运输层',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-12-28 19:51:09'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Road To Peak" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/me.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">16</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/mn9.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Road To Peak</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">计算机网络-5运输层</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-12-26T13:14:31.000Z" title="发表于 2021-12-26 21:14:31">2021-12-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-12-28T11:51:09.741Z" title="更新于 2021-12-28 19:51:09">2021-12-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>22分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="计算机网络-5运输层"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="运输层概述"><a href="#运输层概述" class="headerlink" title="运输层概述"></a>运输层概述</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p><strong>进程之间的通信</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640570397495-image.png"></p>
<ul>
<li>从通信和信息处理的角度看，运输层向它上面的应用层提供通信服务，<strong>它属于面向通信部分的最高层，同时也是用户功能中的最低层</strong>。</li>
<li>当网络的边缘部分中的两个主机使用网络的核心部分的功能进行端到端的通信时，<strong>只有位于网络边缘部分的主机的协议栈才有运输层</strong>，而网络核心部分中的路由器在转发分组时都只用到三层（到网络层）的功能。 </li>
</ul>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640570382327-image.png"></p>
<p><strong>进程之间通信流程</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640570412444-image.png"></p>
<p>“逻辑通信”是指运输层之间的通信好像是沿水平方向传送数据，但事实上，这两条数据并没有一条水平方向的物理连接，要传送的数据是沿着图中上下多次的虚线方向传送的</p>
<blockquote>
<p>进程Ap1与Ap4之间进行基于网络的通信，进程Ap2与Ap3之间进行基于网络的通信</p>
<p>在运输层使用不同的端口，来对应不同的应用进程</p>
<p>然后通过网络层及其下层来传输应用层报文</p>
<p>接收方的运输层通过不同的端口，将收到的应用层报文，交付给应用层中相应的应用进程</p>
<p>这里端口并不是指看得见、摸得着的物理端口，而是指用来区分不同应用进程的标识符</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640570431417-image.png"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640570455190-image.png"></p>
<hr>
<h1 id="运输层端口号、复用与分用的概念"><a href="#运输层端口号、复用与分用的概念" class="headerlink" title="运输层端口号、复用与分用的概念"></a>运输层端口号、复用与分用的概念</h1><h2 id="为什么用端口号"><a href="#为什么用端口号" class="headerlink" title="为什么用端口号"></a>为什么用端口号</h2><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640570698686-image.png"></p>
<h2 id="发送方的复用和接收方的分用"><a href="#发送方的复用和接收方的分用" class="headerlink" title="发送方的复用和接收方的分用"></a>发送方的复用和接收方的分用</h2><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640570710106-image.png"></p>
<blockquote>
<p><strong>多个进程（这里一个端口表示一个进程）</strong> 利用一个运输层协议（或者称为运输层接口）<strong>发送</strong>数据称为 <strong>复用</strong></p>
<p><strong>多个进程（这里一个端口表示一个进程）</strong> 利用一个运输层协议（或者称为运输层接口）<strong>接收</strong>时叫做  <strong>分用</strong>。</p>
</blockquote>
<h2 id="TCP-IP体系的应用层常用协议所使用的运输层熟知端口号"><a href="#TCP-IP体系的应用层常用协议所使用的运输层熟知端口号" class="headerlink" title="TCP/IP体系的应用层常用协议所使用的运输层熟知端口号"></a>TCP/IP体系的应用层常用协议所使用的运输层熟知端口号</h2><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640570726065-image.png"></p>
<p><strong>在运输层不管用TCP还是UDP协议，在网络层都得用IP协议。IP数据报首部中协议字段的值，表明了IP数据报数据载荷部分，封装的是何种协议数据单元。</strong></p>
<h2 id="运输层传输流程"><a href="#运输层传输流程" class="headerlink" title="运输层传输流程"></a>运输层传输流程</h2><p>举例</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640570742253-image.png"></p>
<blockquote>
<p>在浏览器输入域名，回车浏览</p>
<p>然后用户PC中的DNS客户端进程会发送一个DNS查询请求报文</p>
<p>DNS查询请求报文需要使用运输层的UDP协议</p>
<p>首部中的源端口字段的值，在短暂端口号49151~65535中挑选一个未被占用的，用来表示DNS客户端进程</p>
<p>首部中的目的端口字段的值：53，是DNS服务器端进程所使用的熟知端口号</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640570763034-image.png"></p>
<blockquote>
<p>之后，将UDP用户数据报封装在IP数据报中，通过以太网发送给DNS服务器</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640570822635-image.png"></p>
<blockquote>
<p>DNS服务器收到该IP数据报后，从中解封出UDP用户数据报</p>
<p>UDP首部中的目的端口号为53，这表明应将该UDP用户数据报的数据载荷部分，也就是DNS查询请求报文，交付给本服务器中的DNS服务器端进程</p>
<p>DNS服务器端进程解析DNS查询请求报文的内容，然后按其要求查找对应的IP地址</p>
<p>之后，会给用户PC发送DNS响应报文，DNS响应报文需要使用运输层的UDP协议封装成UDP用户数据报</p>
<p>其首部中的源端口字段的值设置为熟知端口号53，表明这是DNS服务器端进程所发送的UDP用户数据报，目的端口的值设置为49152，这是之前用户PC中发送DNS查询请求报文的DNS客户端进程所使用的短暂端口号</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640570847903-image.png"></p>
<blockquote>
<p>将UDP用户数据报封装在IP数据报中，通过以太网发送给用户PC</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640570859587-image.png"></p>
<blockquote>
<p>用户PC收到该数据报后，从中解封出UDP用户数据报</p>
<p>UDP首部中的目的端口号为49152，这表明应将该UDP用户数据报的数据载荷部分，也就是DNS响应报文，交付给用户PC中的DNS客户端进程</p>
<p>DNS客户端进程解析DNS响应报文的内容，就可知道自己之前所请求的Web服务器的域名对应的IP地址</p>
</blockquote>
<p>现在用户PC中的HTTP客户端进程可以向Web服务器发送HTTP请求报文（和DNS发送和接收流程差不多）</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640571228264-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640571247168-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640571255174-image.png"></p>
<hr>
<h1 id="UDP和TCP的对比"><a href="#UDP和TCP的对比" class="headerlink" title="UDP和TCP的对比"></a>UDP和TCP的对比</h1><h2 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h2><ul>
<li><strong>UDP</strong> 和 <strong>TCP</strong> 是TCP/IP体系结构<strong>运输层</strong>中的两个重要协议</li>
<li>当运输层采用面向连接的 <strong>TCP</strong> 协议时，尽管下面的网络是不可靠的（只提供尽最大努力服务），但这种逻辑通信信道就相当于一条<strong>全双工的可靠信道</strong>。</li>
<li>当运输层采用无连接的 <strong>UDP</strong> 协议时，这种逻辑通信信道是一条<strong>不可靠信道</strong>。 </li>
</ul>
<p>可靠信道与不可靠信道</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640571544489-image.png"></p>
<ul>
<li><p>两个对等运输实体在通信时传送的数据单位叫作<strong>运输协议数据单元</strong> TPDU (Transport Protocol Data Unit)。</p>
</li>
<li><p>TCP 传送的数据单位协议是 <strong>TCP 报文段</strong>(segment)。</p>
</li>
<li><p>UDP 传送的数据单位协议是 <strong>UDP 报文</strong>或<strong>用户数据报</strong>。</p>
</li>
</ul>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640594363177-image.png"></p>
<p>UDP的通信是无连接的，不需要套接字（Socket）</p>
<p>TCP是面向连接的，TCP之间的通信必须要在两个套接字（Socket）之间建立连接</p>
<h2 id="用户数据报协议UDP（User-Datagram-Protocol）"><a href="#用户数据报协议UDP（User-Datagram-Protocol）" class="headerlink" title="用户数据报协议UDP（User Datagram Protocol）"></a>用户数据报协议UDP（User Datagram Protocol）</h2><p>可以发送广播</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640594379987-image.png"></p>
<p>可以向某个多播组发送多播</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640594389652-image.png"></p>
<p>还可以发送单播</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640594463753-image.png"></p>
<blockquote>
<p>UDP 支持单播、多播以及广播</p>
<p>换句话说，UDP支持一对一，一对多，以及一对全的通信</p>
</blockquote>
<p>运输过程</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640594478507-image.png"></p>
<blockquote>
<p>UDP对应用进程交下来的报文既不合并也不拆分，而是保留这些报文的边界</p>
<p>换句话说，UDP是面向应用报文的</p>
</blockquote>
<p>UDP向上层提供无连接不可靠传输服务</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640594489817-image.png"></p>
<p>UDP结构</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640594498410-image.png"></p>
<h2 id="传输控制协议TCP（Transmission-Control-Protocol）"><a href="#传输控制协议TCP（Transmission-Control-Protocol）" class="headerlink" title="传输控制协议TCP（Transmission Control Protocol）"></a>传输控制协议TCP（Transmission Control Protocol）</h2><p>使用TCP协议的通信双方，在进行数据传输之前，必须使用“三报文握手”建立TCP连接</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640594508156-image.png"></p>
<p>TCP连接建立成功后，通信双方之间就好像有一条可靠的通信信道，通信双方使用这条基于TCP连接的可靠信道进行通信</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640594516929-image.png"></p>
<blockquote>
<p>很显然，TCP仅支持单播，也就是一对一的通信</p>
</blockquote>
<p>运输过程</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640594534085-image.png"></p>
<blockquote>
<p>发送方</p>
<ul>
<li><p>TCP会把应用进程交付下来的数据块看作是一连串无结构的字节流，TCP并不知道这些待传送的字节流的含义</p>
</li>
<li><p>并将他们编号，并存储在自己发送缓存中</p>
</li>
<li><p>TCP会根据发送策略，提取一定量的字节构建TCP报文并发送</p>
</li>
</ul>
<p>接收方</p>
<ul>
<li>一方面从所接受到的TCP报文段中，取出数据载荷部分并存储在接收缓存中；一方面将接收缓存中的一些字节交付给应用进程</li>
<li>TCP不保证接收方应用进程所收到的数据块与发送方发送的数据块，具有对应大小的关系（例如，发送方应用进程交给发送方的TCP共10个数据块，但接收方的TCP可能只用了4个数据块，就把收到的字节流交付给了上层的应用进程，但接收方收到的字节流必须和发送方应用进程发出的字节流完全一样）</li>
<li>接收方的应用进程必须有能力识别收到的字节流，把它还原成有意义的应用层数据</li>
</ul>
<p>TCP是面向字节流的，这正是TCP实现可靠传输、流量控制、以及拥塞控制的基础</p>
<p>本图只画了一个方向的数据流，在实际网络中，基于TCP连接的两端，可以同时进行TCP报文段的发送和接收</p>
</blockquote>
<p>TCP向上层提供面向连接的可靠传输服务</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640594545712-image.png"></p>
<p>TCP结构</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640594563129-image.png"></p>
<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640594577884-image.png"></p>
<hr>
<h1 id="TCP的流量控制"><a href="#TCP的流量控制" class="headerlink" title="TCP的流量控制"></a>TCP的流量控制</h1><h2 id="概念-2"><a href="#概念-2" class="headerlink" title="概念"></a>概念</h2><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640596277539-image.png"></p>
<p>举例</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1c4411d7jb?p=60">具体流程的视频</a></p>
<p>下图中大写的ACK是TCP报文段首部中的标志位，取值1表示这是一个TCP确认报文段，小写ack是TCP报文段首部中的确认号字段，取值201表示序号201之前的数据已全部正确接收，现在希望收到序号201及其后续数据。rwnd是TCP报文段首部中的窗口字段，取值300表示自己的接收窗口大小为300</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640596290411-image.png"></p>
<p>上图主机A现在可将发送缓存中序号1~200的字节数据全部删除，因为已经收到了主机B对它们的累计确认</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640596300641-image.png"></p>
<p>上图主机A，发送窗口内序号201 ~ 300这100个字节数据的重传计时器超时了，主机A将它们重新封装成一个TCP报文段发送出去，暂时不能发送其它数据。主机B收到该重传的TCP报文段后，对主机A发送的501号之前的数据进行累计确认。并在该累计确认中，将窗口字段的值调整为100，这是主机B对主机A进行的第二次流量控制。</p>
<p>主机A收到该累计确认后，将发送窗口向前滑动，使已发送并收到确认的这些数据的序号移出发送窗口。由于主机B在该累计确认中，将自己的接收窗口调整为了100，因此，主机A相应的将自己的发送窗口调整为100。</p>
<p>目前主机A发送窗口内的序号为501 ~ 600，也就是主机A还可以发送这100字节。主机A现在可将发送缓存中序号201~500的字节数据全部删除，因为已经收到了主机B对它们的累计确认</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640596666730-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640596360544-image.png"></p>
<p>上图主机A现在可将发送缓存中序号501~600的字节数据全部删除，因为已经收到了主机B对它们的累计确认</p>
<p>在本例中，主机A收到零窗口通知时，就启动一个持续计时器，当持续计时器超时，主机A立刻发送一个仅携带一字节数据的零窗口探测报文段。假设主机B此时的接收窗口又为0了，主机B就在确认这个零窗口探测报文段时，给出自己现在的接收窗口值为0，主机A再次收到零窗口通知，就再次启动一个持续计时器，当持续计时器超时，主机A就立刻发送一个零窗口探测报文段，假设主机B此时的接收缓存又有了一些存储空间，于是将自己的接收窗口调整为了300，主机B就在确认这个零窗口探测报文段时，给出自己现在的接收窗口值为300，这样就打破了死锁的局面。</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640596388493-image.png"><br>问题：</p>
<p>主机A所发送的零窗口探测报文段到达主机B时，如果主机B此时的接收窗口仍然为0，那么主机B根本无法接收该报文段，又怎么会针对该报文段给主机A发回确认呢？</p>
<p>答：<strong>TCP规定，即使接收窗口为0，也必须接收零窗口探测报文段、确认报文段、以及携带有紧急数据的报文段。</strong></p>
<p>问题2：</p>
<p>上图如果零窗口探测报文在发送过程中如果丢失，能否打破死锁局面？</p>
<p>答：<strong>能，因为零窗口探测报文段也有重传计时器，重传计时器超时后，零窗口探测报文段会被重传。</strong></p>
<p>练习：</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640598743827-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640598801135-image.png"><br>由于主机乙在确认中，给出自己的接收窗口大小为2000字节，因此主机甲相应的将自己的发送窗口调整为2000字节。显然，主机甲还可以向主机乙发送2000 ~ 2999号字节数据，共1000个字节。</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640598879935-image.png"></p>
<h2 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h2><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640596690044-image.png"></p>
<hr>
<h1 id="TCP的拥塞控制"><a href="#TCP的拥塞控制" class="headerlink" title="TCP的拥塞控制"></a>TCP的拥塞控制</h1><h2 id="概念-3"><a href="#概念-3" class="headerlink" title="概念"></a>概念</h2><p>a<br><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640596700235-image.png"></p>
<p><strong>网络拥塞往往是由许多因素引起的。例如：</strong></p>
<ol>
<li>点缓存的容量太小；</li>
<li>链路的容量不足；</li>
<li>处理机处理的速率太慢；</li>
<li>拥塞本身会进一步加剧拥塞；</li>
</ol>
<p><strong>拥塞控制的一般原理</strong></p>
<ul>
<li>拥塞控制的前提：网络能够承受现有的网络负荷。</li>
<li>实践证明，拥塞控制是很难设计的，因为它是一个<strong>动态问题</strong>。</li>
<li>分组的丢失是网络发生拥塞的<strong>征兆</strong>而不是原因。</li>
<li>在许多情况下，甚至正是<strong>拥塞控制本身</strong>成为引起网络性能恶化、甚至发生死锁的原因。</li>
</ul>
<p><strong>开环控制和闭环控制</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640596711502-image.png"></p>
<p><strong>监测网络的拥塞</strong></p>
<p>主要指标有：</p>
<ol>
<li>由于缺少缓存空间而被丢弃的分组的百分数；</li>
<li>平均队列长度；</li>
<li>超时重传的分组数；</li>
<li>平均分组时延；</li>
<li>分组时延的标准差，等等。</li>
</ol>
<p>上述这些指标的上升都标志着拥塞的增长。</p>
<h2 id="拥塞控制的算法"><a href="#拥塞控制的算法" class="headerlink" title="拥塞控制的算法"></a>拥塞控制的算法</h2><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-27/1640596724391-image.png"></p>
<blockquote>
<p>真正的发送窗口值 = Min (接收方窗口值，拥塞窗口值)</p>
</blockquote>
<p>下图的实例横纵坐标的意思</p>
<p>传输轮次：</p>
<ul>
<li>发送方给接收方发送数据报文段后，接收方给发送方发发回相应的确认报文段</li>
<li>一个传输轮次所经历的时间其实就是往返时间，往返时间并非是恒定的数值</li>
<li>使用传输轮次是为了强调把拥塞窗口所允许发送的报文段都连续发送出去，并受到了对已发送的最后一个报文段的确认</li>
</ul>
<p>拥塞窗口：</p>
<ul>
<li>它会随网络拥塞程度，以及所使用的拥塞控制算法动态变化</li>
</ul>
<h3 id="慢开始和拥塞避免"><a href="#慢开始和拥塞避免" class="headerlink" title="慢开始和拥塞避免"></a>慢开始和拥塞避免</h3><h4 id="慢开始（slow-start）"><a href="#慢开始（slow-start）" class="headerlink" title="慢开始（slow-start）"></a>慢开始（slow-start）</h4><ul>
<li>目的：用来确定网络的负载能力或拥塞程度。</li>
<li>算法的思路：由小到大逐渐增大拥塞窗口数值。</li>
<li>两个变量：<ul>
<li><strong>拥塞窗口（cwnd）</strong>：初始拥塞窗口值：2 种设置方法。窗口值逐渐增大。<ul>
<li>1 至 2 个最大报文段 （旧标准）</li>
<li>2 至 4 个最大报文段 （RFC 5681）</li>
</ul>
</li>
<li><strong>慢开始门限（ssthresh）</strong>：防止拥塞窗口增长过大引起网络拥塞。</li>
</ul>
</li>
</ul>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640672800796-image.png"></p>
<blockquote>
<p>图中swnd是发送窗口</p>
<p>每经过一个传输轮次，拥塞窗口就加倍</p>
<p>窗口大小按<strong>指数增加</strong>，2的n-1次方</p>
</blockquote>
<h4 id="拥塞避免（congestion-avoidance）"><a href="#拥塞避免（congestion-avoidance）" class="headerlink" title="拥塞避免（congestion avoidance）"></a>拥塞避免（congestion avoidance）</h4><ul>
<li>思路：让拥塞窗口 cwnd <strong>缓慢地增大</strong>，避免出现拥塞。</li>
<li>每经过一个传输轮次，拥塞窗口 <strong>cwnd = cwnd + 1</strong>。</li>
<li>使拥塞窗口 cwnd 按线性规律缓慢增长。</li>
<li>在拥塞避免阶段，具有 “<strong>加法增大</strong>” (Additive Increase) 的特点。</li>
</ul>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640672827246-image.png"></p>
<p>如果在发送过程中出现部分报文段丢失，这必然会造成发送方对这些丢失报文段的超时重传</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640672837802-image.png"></p>
<p>这个时候又回到了慢开始</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640672850929-image.png"></p>
<h4 id="两个算法完整示意图"><a href="#两个算法完整示意图" class="headerlink" title="两个算法完整示意图"></a>两个算法完整示意图</h4><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640672860893-image.png"></p>
<h3 id="快重传和快恢复"><a href="#快重传和快恢复" class="headerlink" title="快重传和快恢复"></a>快重传和快恢复</h3><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640672874679-image.png"></p>
<h4 id="快重传（fast-retrasmit）"><a href="#快重传（fast-retrasmit）" class="headerlink" title="快重传（fast retrasmit）"></a>快重传（fast retrasmit）</h4><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640672884424-image.png"></p>
<h4 id="快恢复（fast-recovery）"><a href="#快恢复（fast-recovery）" class="headerlink" title="快恢复（fast recovery）"></a>快恢复（fast recovery）</h4><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640672895607-image.png"></p>
<h4 id="改进后的整体算法的示意图"><a href="#改进后的整体算法的示意图" class="headerlink" title="改进后的整体算法的示意图"></a>改进后的整体算法的示意图</h4><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640672905250-image.png"></p>
<hr>
<h1 id="TCP超时重传时间的选择"><a href="#TCP超时重传时间的选择" class="headerlink" title="TCP超时重传时间的选择"></a>TCP超时重传时间的选择</h1><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640678883966-image.png"></p>
<blockquote>
<p>如果超时重传时间RTO的值设置得比RTT0的值小很多，这会引起报文段不必要的重传，使网络负荷增大</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640678900627-image.png"></p>
<blockquote>
<p>如果超时重传时间RTO的值设置得远大于RTT0的值，这会使重传时间推迟的太长，使网络的空闲时间增大，降低传输效率</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640678932186-image.png"></p>
<p><strong>RFC6298建议使用下式计算超时重传时间RTO</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640678951370-image.png"></p>
<p><strong>往返时间RTT的测量比较复杂</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640678967280-image.png"></p>
<p><strong>TCP超时重传的计算</strong></p>
<p>举例</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640678990994-image.png"></p>
<p><strong>总结</strong></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640678999939-image.png"></p>
<hr>
<h1 id="TCP可靠传输的实现"><a href="#TCP可靠传输的实现" class="headerlink" title="TCP可靠传输的实现"></a>TCP可靠传输的实现</h1><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1c4411d7jb?p=63">本集具体讲解</a></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640679671661-image.png"></p>
<p>接收方表明自己的接收窗口的尺寸为20字节，确认号字段的值为31，这表明接收方希望收到下一个数据的序号是31，而序号30为止的数据已经全部正确接收了。</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640679686142-image.png"><br>向后收缩，这发生在通知方通知的窗口变小了，但TCP标准<strong>强烈不赞成这样做</strong>，因为很可能发送方在收到这个通知之前，就已经发送了窗口中的许多数据，现在又要收缩窗口，不让发送这些数据，显然就会产生错误。</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640680000273-image.png"></p>
<p>取其中一段分析：</p>
<p>现在，假设又有几个数据报文段到达了接收方，它们封装有37，38以及40号数据。这些数据的序号虽然落在接收窗口内，但它们都是未按序到达的数据，只能先暂存在接收缓存中。（<strong>接收方只能对按序收到的数据中的最高序号给出确认，因此接收方发出的确认报文段中的确认序号仍然是34！</strong>），假设接收方先前发送的确认报文段到达了发送方，发送方接收后，将发送窗口向前滑动3个序号，发送窗口的尺寸保持不变，这样就有51 ~ 53落入发送窗口内（TCP的通信是全双工通信），而序号31 ~ 33移出了发送窗口，现在可将31 ~ 33号数据从发送缓存中删除了，因为已经收到了接收方针对它们的确认。</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640680878218-1111%2000_00_00-00_00_30.gif"></p>
<p>发送方继续将发送窗口内序号42 ~ 53的数据，封装在几个不同的报文段中发送出去。现在，发送窗口内的序号已经用完了，发送方在未收到接收方发来确认的情况下，不能再发送新的数据。序号落在发送窗口内的已发送数据，如果迟迟收不到接收方的确认，则会产生超时重传。</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640681334428-2222%2000_00_00-00_00_30.gif"></p>
<p>练习：</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640683418223-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640684428298-image.png"></p>
<p>小结：<br><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640680009785-image.png"></p>
<hr>
<h1 id="TCP的运输连接管理"><a href="#TCP的运输连接管理" class="headerlink" title="TCP的运输连接管理"></a>TCP的运输连接管理</h1><h2 id="概念-4"><a href="#概念-4" class="headerlink" title="概念"></a>概念</h2><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687086367-image.png"></p>
<h2 id="TCP的连接建立"><a href="#TCP的连接建立" class="headerlink" title="TCP的连接建立"></a>TCP的连接建立</h2><ul>
<li>TCP 建立连接的过程叫做<strong>握手</strong>。</li>
<li>握手需要在客户和服务器之间交换三个 TCP 报文段。称之为<strong>三报文握手</strong>。</li>
<li>采用<strong>三报文握手</strong>主要是为了防止已失效的连接请求报文段突然又传送到了，因而产生错误。</li>
</ul>
<h3 id="TCP的连接建立要解决以下三个问题"><a href="#TCP的连接建立要解决以下三个问题" class="headerlink" title="TCP的连接建立要解决以下三个问题"></a>TCP的连接建立要解决以下三个问题</h3><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687111374-image.png"></p>
<h3 id="TCP使用“三报文握手”建立连接"><a href="#TCP使用“三报文握手”建立连接" class="headerlink" title="TCP使用“三报文握手”建立连接"></a>TCP使用“三报文握手”建立连接</h3><ul>
<li>TCP 连接的建立<strong>采用客户服务器方式</strong>。</li>
<li>主动发起连接建立的应用进程叫做<strong>TCP客户</strong> (client)。</li>
<li>被动等待连接建立的应用进程叫做<strong>TCP服务器</strong> (server)。</li>
</ul>
<p>“握手”需要在TCP客户端和服务器之间交换三个TCP报文段</p>
<p>过程</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687123235-image.png"></p>
<blockquote>
<p>最初两端的TCP进程都处于关闭状态</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687134793-image.png"></p>
<blockquote>
<p>一开始，TCP服务器进程首先创建传输控制块，用来存储TCP连接中的一些重要信息。例如TCP连接表、指向发送和接收缓存的指针、指向重传队列的指针，当前的发送和接收序号等</p>
<p>之后，就准备接受TCP客户端进程的连接请求</p>
<p>此时，TCP服务器进程就进入监听状态，等待TCP客户端进程的连接请求</p>
</blockquote>
<p>TCP服务器进程是被动等待来自TCP客户端进程的连接请求，因此成为<strong>被动打开</strong>连接</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687152119-image.png"></p>
<blockquote>
<p>TCP客户进程也是首先创建传输控制块</p>
</blockquote>
<p>由于TCP连接建立是由TCP客户端主动发起的，因此称为<strong>主动打开</strong>连接</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687169382-image.png"></p>
<blockquote>
<p>然后，在打算建立TCP连接时，向TCP服务器进程发送TCP连接请求报文段，并进入同步已发送状态</p>
<p>TCP连接请求报文段首部中</p>
<ul>
<li>同步位SYN被设置为1，表明这是一个TCP连接请求报文段</li>
<li>序号字段seq被设置了一个初始值x，作为TCP客户端进程所选择的初始序号</li>
</ul>
<p>请注意：TCP规定SYN被设置为1的报文段不能携带数据，但要消耗掉一个序号</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687179871-image.png"></p>
<blockquote>
<p>TCP服务器进程收到TCP连接请求报文段后，如果同意建立连接，则向TCP客户进程发送TCP连接请求确认报文段，并进入同步已接收状态</p>
<p>TCP连接请求确认报文段首部中</p>
<ul>
<li>同步位SYN和确认为ACK都设置为1，表明这是一个TCP连接请求确认报文段</li>
<li>序号字段seq被设置了一个初始值y，作为TCP服务器进程所选择的初始序号，</li>
<li>确认号字段ack的值被设置成了x+1，这是对TCP客户进程所选择的初始序号（seq）的确认</li>
</ul>
<p>请注意：这个报文段也不能携带数据，因为它是SYN被设置为1的报文段，但同样要消耗掉一个序号</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687191428-image.png"></p>
<blockquote>
<p>TCP客户进程收到TCP连接请求确认报文段后，还要向TCP服务器进程发送一个普通的TCP确认报文段，并进入连接已连接状态</p>
<p>普通的TCP确认报文段首部中</p>
<ul>
<li>确认位ACK被设置为1，表明这是一个普通的TCP确认报文段</li>
<li>序号字段seq被设置为x+1，这是因为TCP客户进程发送的第一个TCP报文段的序号为x，所以TCP客户进程发送的第二个报文段的序号为x+1</li>
<li>确认号字段ack被设置为y+1，这是对TCP服务器进程所选择的初始序号的确认</li>
</ul>
<p>请注意：TCP规定普通的TCP确认报文段可以携带数据，但如果不携带数据，则不消耗序号</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687299599-image.png"></p>
<blockquote>
<p>TCP服务器进程收到该确认报文段后也进入连接已建立状态</p>
<p>现在，TCP双方都进入了连接已建立状态，它们可以基于已建立好的TCP连接，进行可靠的数据传输</p>
</blockquote>
<p>为什么TCP客户进程最后还要发送一个普通的TCP确认报文段？能否使用“两报文握手”建立连接？</p>
<p>下图实例是“两报文握手”</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687246401-image.png"></p>
<blockquote>
<p>为了防止已经失效的连接请求报文段突然又传到服务端，因而产生错误”，这种情况是：一端(client)A发出去的第一个连接请求报文并没有丢失，而是因为某些未知的原因在某个网络节点上发生滞留，导致延迟到连接释放以后的某个时间才到达另一端(server)B。</p>
<p>本来这是一个早已失效的报文段，但是B收到此失效的报文之后，会误认为是A再次发出的一个新的连接请求，于是B端就向A又发出确认报文，表示同意建立连接。如果不采用“三次握手”，那么只要B端发出确认报文就会认为新的连接已经建立了，但是A端并没有发出建立连接的请求，因此不会去向B端发送数据，B端没有收到数据就会一直等待，这样B端就会白白浪费掉很多资源。</p>
<p>所以并不<strong>多余</strong>，这是为了防止已失效的连接请求报文段突然又传送到了TCP服务器，因而导致错误</p>
</blockquote>
<p>练习：</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640686977693-image.png"></p>
<blockquote>
<p>主机乙中seq值可以随意指定！</p>
</blockquote>
<h3 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h3><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640686820398-image.png"></p>
<h2 id="TCP的连接释放"><a href="#TCP的连接释放" class="headerlink" title="TCP的连接释放"></a>TCP的连接释放</h2><ul>
<li>TCP 连接释放过程比较复杂。</li>
<li>数据传输结束后，通信的双方都可释放连接。</li>
<li>TCP 连接释放过程是<strong>四报文握手</strong>。</li>
</ul>
<h3 id="TCP通过“四报文挥手”来释放连接"><a href="#TCP通过“四报文挥手”来释放连接" class="headerlink" title="TCP通过“四报文挥手”来释放连接"></a>TCP通过“四报文挥手”来释放连接</h3><ul>
<li>TCP 连接的建立<strong>采用客户服务器方式</strong>。</li>
<li>主动发起连接建立的应用进程叫做<strong>TCP客户</strong> (client)。</li>
<li>被动等待连接建立的应用进程叫做<strong>TCP服务器</strong> (server)。</li>
<li><strong>任何一方都可以在数据传送结束后发出连接释放的通知</strong></li>
</ul>
<p>过程</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687336148-image.png"></p>
<blockquote>
<p>现在TCP客户进程和TCP服务器进程都处于连接已建立状态</p>
<p>TCP客户进程的应用进程通知其主动关闭TCP连接</p>
<p>TCP客户进程会发送TCP连接释放报文段，并进入终止等待1状态</p>
<p>TCP连接释放报文段首部中</p>
<ul>
<li>终止位FIN和确认为ACK的值都被设置为1，表明这是一个TCP连接释放报文段，同时也对之前收到的报文段进行确认</li>
<li>序号seq字段的值设置为u，它等于TCP客户进程之前已传送过的数据的最后一个字节的序号加1</li>
<li>确认号ack字段的值设置为v，它等于TCP客户进程之前已收到的、数据的最后一个字节的序号加1</li>
</ul>
<p>请注意：TCP规定终止位FIN等于1的报文段即使不携带数据，也要消耗掉一个序号</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687344791-image.png"></p>
<blockquote>
<p>TCP服务器进程收到TCP连接释放报文段后，会发送一个普通的TCP确认报文段并进入关闭等待状态</p>
<p>普通的TCP确认报文段首部中</p>
<ul>
<li>确认位ACK的值被设置为1，表明这是一个普通的TCP确认报文段</li>
<li>序号seq字段的值设置为v，它等于TCP服务器进程之前已传送过的数据的最后一个字节的序号加1，这也与之前收到的TCP连接释放报文段中的确认号匹配</li>
<li>确认号ack字段的值设置为u+1，这是对TCP连接释放报文段的确认</li>
</ul>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687353383-image.png"></p>
<blockquote>
<p>TCP服务器进程应该通知高层应用进程，TCP客户进程要断开与自己的TCP连接</p>
<p>此时，从TCP客户进程到TCP服务器进程这个方向的连接就释放了</p>
<p>这时的TCP连接属于半关闭状态，也就是TCP客户进程已经没有数据要发送了</p>
<p>但如果TCP服务器进程还有数据要发送，TCP客户进程仍要接收，也就是说从TCP服务器进程到TCP客户进程这个方向的连接并未关闭</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687362766-image.png"></p>
<blockquote>
<p>TCP客户进程收到TCP确认报文段后就进入终止等待2状态，等待TCP服务器进程发出的TCP连接释放报文段</p>
<p>若使用TCP服务器进程的应用进程已经没有数据要发送了，应用进程就通知其TCP服务器进程释放连接</p>
<p>由于TCP连接释放是由TCP客户进程主动发起的，因此TCP服务器进程对TCP连接的释放称为被动关闭连接</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687373721-image.png"></p>
<blockquote>
<p>TCP服务器进程发送TCP连接释放报文段并进入最后确认状态</p>
<p>该报文段首部中</p>
<ul>
<li>终止位FIN和确认位ACK的值都被设置为1，表明这是一个TCP连接释放报文段，同时也对之前收到的报文段进行确认</li>
<li>序号seq字段的值为w，这是因为在半关闭状态下，TCP服务器进程可能又发送</li>
<li>确认号ack字段的值为u+1，这是对之前收到的TCP连接释放报文段的重复确认</li>
</ul>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687385502-image.png"></p>
<blockquote>
<p>TCP客户进程收到TCP连接释放报文段后，必须针对该报文段发送普通的TCP确认报文段，之后进入时间等待状态</p>
<p>该报文段首部中</p>
<ul>
<li>确认为ACK的值被设置为1，表明这是一个普通的TCP确认报文段</li>
<li>序号seq字段的值设置为u+1，这是因为TCP客户进程之前发送的TCP连接释放报文段虽然不携带数据，但要消耗掉一个序号</li>
<li>确认号ack字段的值设置为w+1，这是对所收到的TCP连接释放报文段的确认</li>
</ul>
<p>TCP服务器进程收到该报文段后就进入关闭状态，而TCP客户进程还要进过2MSL后才能进入关闭状态</p>
</blockquote>
<p>TCP客户进程在发送完最后一个确认报文后，为什么不直接进入关闭状态？而是要进入时间等待状态？</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687399077-image.png"></p>
<blockquote>
<p>因为时间等待状态以及处于该状态2MSL时长，可以确保TCP服务器进程可以收到最后一个TCP确认报文段而进入关闭状态</p>
<p>另外，TCP客户进程在发送完最后一个TCP确认报文段后，在经过2MSL时长，就可以使本次连接持续时间内所产生的所有报文段都从网络中消失，这样就可以使下一个新的TCP连接中，不会出现旧连接中的报文段</p>
</blockquote>
<h3 id="TCP保活计时器的作用"><a href="#TCP保活计时器的作用" class="headerlink" title="TCP保活计时器的作用"></a>TCP保活计时器的作用</h3><p>TCP双方已经建立了连接，后来，TCP客户进程所在的主机突然出现了故障</p>
<p>TCP服务器进程以后就不能再收到TCP客户进程发来的数据</p>
<p>因此，应当有措施使TCP服务器进程不要再白白等待下去</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687414345-image.png"></p>
<hr>
<h1 id="TCP报文段的首部格式"><a href="#TCP报文段的首部格式" class="headerlink" title="TCP报文段的首部格式"></a>TCP报文段的首部格式</h1><p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687441393-image.png"></p>
<h2 id="各字段的作用"><a href="#各字段的作用" class="headerlink" title="各字段的作用"></a>各字段的作用</h2><p>源端口和目的端口</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687457197-image.png"></p>
<p>序号、确认号和确认标志位</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640690654588-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687466989-image.png"></p>
<p>数据偏移、保留、窗口和校验和</p>
<blockquote>
<p>0101十进制值是5，而该字段以4字节为单位，因此5×4字节等于20字节</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687478348-image.png"></p>
<blockquote>
<p>发送窗口大小除了取决于窗口值（流量控制：即以接收方的接收能力来控制发送方的发送能力。），还取决于拥塞窗口的大小，也就是<strong>应从接收窗口和拥塞窗口中取小者。</strong></p>
</blockquote>
<blockquote>
<p>伪首部：是一个虚拟的数据结构，其中的信息是从数据报所在IP分组头的分组头中提取的，既不向下传送也不向上递交，而<strong>仅仅是为计算校验和。</strong><br>同步标志位、终止标志位、复位标志位、推送标志位、紧急标志位和紧急指针</p>
</blockquote>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640691816590-image.png"></p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687490468-image.png"></p>
<p>选项和填充</p>
<p><img src="https://gitee.com/r2peak/picture/raw/master/2021-12-28/1640687499235-image.png"></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%AE%A1%E7%BD%91/">计网</a></div><div class="post_share"><div class="social-share" data-image="/img/mn9.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/12/28/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-6%E5%BA%94%E7%94%A8%E5%B1%82/"><img class="prev-cover" src="/img/mn11.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">计算机网络-6应用层</div></div></a></div><div class="next-post pull-right"><a href="/2021/12/25/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-4%E7%BD%91%E7%BB%9C%E5%B1%82/"><img class="next-cover" src="/img/mn8.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">计算机网络-4网络层</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/12/23/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-2%E7%89%A9%E7%90%86%E5%B1%82/" title="计算机网络-2物理层"><img class="cover" src="/img/mn5.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-23</div><div class="title">计算机网络-2物理层</div></div></a></div><div><a href="/2021/12/22/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-1%E6%A6%82%E8%BF%B0/" title="计算机网络-1概述"><img class="cover" src="/img/mn.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-22</div><div class="title">计算机网络-1概述</div></div></a></div><div><a href="/2021/12/24/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-3%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/" title="计算机网络-3数据链路层"><img class="cover" src="/img/mn10.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-24</div><div class="title">计算机网络-3数据链路层</div></div></a></div><div><a href="/2021/12/25/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-4%E7%BD%91%E7%BB%9C%E5%B1%82/" title="计算机网络-4网络层"><img class="cover" src="/img/mn8.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-25</div><div class="title">计算机网络-4网络层</div></div></a></div><div><a href="/2021/12/28/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-6%E5%BA%94%E7%94%A8%E5%B1%82/" title="计算机网络-6应用层"><img class="cover" src="/img/mn11.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-28</div><div class="title">计算机网络-6应用层</div></div></a></div><div><a href="/2021/12/30/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C1-6%E5%90%88%E9%9B%86/" title="计算机网络1-6合集"><img class="cover" src="/img/dobetter.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-12-30</div><div class="title">计算机网络1-6合集</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/me.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">马厚煜</div><div class="author-info__description">为者常成，行者常至</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">16</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/r2peak"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/r2peak" target="_blank" title="Github"><i class="fab fa-github"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">Start it from the bottom</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%90%E8%BE%93%E5%B1%82%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">运输层概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.2.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%90%E8%BE%93%E5%B1%82%E7%AB%AF%E5%8F%A3%E5%8F%B7%E3%80%81%E5%A4%8D%E7%94%A8%E4%B8%8E%E5%88%86%E7%94%A8%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">2.</span> <span class="toc-text">运输层端口号、复用与分用的概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E7%94%A8%E7%AB%AF%E5%8F%A3%E5%8F%B7"><span class="toc-number">2.1.</span> <span class="toc-text">为什么用端口号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E6%96%B9%E7%9A%84%E5%A4%8D%E7%94%A8%E5%92%8C%E6%8E%A5%E6%94%B6%E6%96%B9%E7%9A%84%E5%88%86%E7%94%A8"><span class="toc-number">2.2.</span> <span class="toc-text">发送方的复用和接收方的分用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP-IP%E4%BD%93%E7%B3%BB%E7%9A%84%E5%BA%94%E7%94%A8%E5%B1%82%E5%B8%B8%E7%94%A8%E5%8D%8F%E8%AE%AE%E6%89%80%E4%BD%BF%E7%94%A8%E7%9A%84%E8%BF%90%E8%BE%93%E5%B1%82%E7%86%9F%E7%9F%A5%E7%AB%AF%E5%8F%A3%E5%8F%B7"><span class="toc-number">2.3.</span> <span class="toc-text">TCP&#x2F;IP体系的应用层常用协议所使用的运输层熟知端口号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%BE%93%E5%B1%82%E4%BC%A0%E8%BE%93%E6%B5%81%E7%A8%8B"><span class="toc-number">2.4.</span> <span class="toc-text">运输层传输流程</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#UDP%E5%92%8CTCP%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">3.</span> <span class="toc-text">UDP和TCP的对比</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5-1"><span class="toc-number">3.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E6%95%B0%E6%8D%AE%E6%8A%A5%E5%8D%8F%E8%AE%AEUDP%EF%BC%88User-Datagram-Protocol%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">用户数据报协议UDP（User Datagram Protocol）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E6%8E%A7%E5%88%B6%E5%8D%8F%E8%AE%AETCP%EF%BC%88Transmission-Control-Protocol%EF%BC%89"><span class="toc-number">3.3.</span> <span class="toc-text">传输控制协议TCP（Transmission Control Protocol）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-number">3.4.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TCP%E7%9A%84%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6"><span class="toc-number">4.</span> <span class="toc-text">TCP的流量控制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5-2"><span class="toc-number">4.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-2"><span class="toc-number">4.2.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TCP%E7%9A%84%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6"><span class="toc-number">5.</span> <span class="toc-text">TCP的拥塞控制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5-3"><span class="toc-number">5.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E7%9A%84%E7%AE%97%E6%B3%95"><span class="toc-number">5.2.</span> <span class="toc-text">拥塞控制的算法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%85%A2%E5%BC%80%E5%A7%8B%E5%92%8C%E6%8B%A5%E5%A1%9E%E9%81%BF%E5%85%8D"><span class="toc-number">5.2.1.</span> <span class="toc-text">慢开始和拥塞避免</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%85%A2%E5%BC%80%E5%A7%8B%EF%BC%88slow-start%EF%BC%89"><span class="toc-number">5.2.1.1.</span> <span class="toc-text">慢开始（slow-start）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%A5%E5%A1%9E%E9%81%BF%E5%85%8D%EF%BC%88congestion-avoidance%EF%BC%89"><span class="toc-number">5.2.1.2.</span> <span class="toc-text">拥塞避免（congestion avoidance）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%A4%E4%B8%AA%E7%AE%97%E6%B3%95%E5%AE%8C%E6%95%B4%E7%A4%BA%E6%84%8F%E5%9B%BE"><span class="toc-number">5.2.1.3.</span> <span class="toc-text">两个算法完整示意图</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%87%8D%E4%BC%A0%E5%92%8C%E5%BF%AB%E6%81%A2%E5%A4%8D"><span class="toc-number">5.2.2.</span> <span class="toc-text">快重传和快恢复</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BF%AB%E9%87%8D%E4%BC%A0%EF%BC%88fast-retrasmit%EF%BC%89"><span class="toc-number">5.2.2.1.</span> <span class="toc-text">快重传（fast retrasmit）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BF%AB%E6%81%A2%E5%A4%8D%EF%BC%88fast-recovery%EF%BC%89"><span class="toc-number">5.2.2.2.</span> <span class="toc-text">快恢复（fast recovery）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%B9%E8%BF%9B%E5%90%8E%E7%9A%84%E6%95%B4%E4%BD%93%E7%AE%97%E6%B3%95%E7%9A%84%E7%A4%BA%E6%84%8F%E5%9B%BE"><span class="toc-number">5.2.2.3.</span> <span class="toc-text">改进后的整体算法的示意图</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TCP%E8%B6%85%E6%97%B6%E9%87%8D%E4%BC%A0%E6%97%B6%E9%97%B4%E7%9A%84%E9%80%89%E6%8B%A9"><span class="toc-number">6.</span> <span class="toc-text">TCP超时重传时间的选择</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TCP%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">7.</span> <span class="toc-text">TCP可靠传输的实现</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TCP%E7%9A%84%E8%BF%90%E8%BE%93%E8%BF%9E%E6%8E%A5%E7%AE%A1%E7%90%86"><span class="toc-number">8.</span> <span class="toc-text">TCP的运输连接管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5-4"><span class="toc-number">8.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP%E7%9A%84%E8%BF%9E%E6%8E%A5%E5%BB%BA%E7%AB%8B"><span class="toc-number">8.2.</span> <span class="toc-text">TCP的连接建立</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP%E7%9A%84%E8%BF%9E%E6%8E%A5%E5%BB%BA%E7%AB%8B%E8%A6%81%E8%A7%A3%E5%86%B3%E4%BB%A5%E4%B8%8B%E4%B8%89%E4%B8%AA%E9%97%AE%E9%A2%98"><span class="toc-number">8.2.1.</span> <span class="toc-text">TCP的连接建立要解决以下三个问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP%E4%BD%BF%E7%94%A8%E2%80%9C%E4%B8%89%E6%8A%A5%E6%96%87%E6%8F%A1%E6%89%8B%E2%80%9D%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5"><span class="toc-number">8.2.2.</span> <span class="toc-text">TCP使用“三报文握手”建立连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-3"><span class="toc-number">8.2.3.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP%E7%9A%84%E8%BF%9E%E6%8E%A5%E9%87%8A%E6%94%BE"><span class="toc-number">8.3.</span> <span class="toc-text">TCP的连接释放</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP%E9%80%9A%E8%BF%87%E2%80%9C%E5%9B%9B%E6%8A%A5%E6%96%87%E6%8C%A5%E6%89%8B%E2%80%9D%E6%9D%A5%E9%87%8A%E6%94%BE%E8%BF%9E%E6%8E%A5"><span class="toc-number">8.3.1.</span> <span class="toc-text">TCP通过“四报文挥手”来释放连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP%E4%BF%9D%E6%B4%BB%E8%AE%A1%E6%97%B6%E5%99%A8%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">8.3.2.</span> <span class="toc-text">TCP保活计时器的作用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TCP%E6%8A%A5%E6%96%87%E6%AE%B5%E7%9A%84%E9%A6%96%E9%83%A8%E6%A0%BC%E5%BC%8F"><span class="toc-number">9.</span> <span class="toc-text">TCP报文段的首部格式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%84%E5%AD%97%E6%AE%B5%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">9.1.</span> <span class="toc-text">各字段的作用</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/12/30/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C1-6%E5%90%88%E9%9B%86/" title="计算机网络1-6合集"><img src="/img/dobetter.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机网络1-6合集"/></a><div class="content"><a class="title" href="/2021/12/30/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C1-6%E5%90%88%E9%9B%86/" title="计算机网络1-6合集">计算机网络1-6合集</a><time datetime="2021-12-30T14:48:31.000Z" title="发表于 2021-12-30 22:48:31">2021-12-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/12/28/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-6%E5%BA%94%E7%94%A8%E5%B1%82/" title="计算机网络-6应用层"><img src="/img/mn11.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机网络-6应用层"/></a><div class="content"><a class="title" href="/2021/12/28/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-6%E5%BA%94%E7%94%A8%E5%B1%82/" title="计算机网络-6应用层">计算机网络-6应用层</a><time datetime="2021-12-28T13:52:31.000Z" title="发表于 2021-12-28 21:52:31">2021-12-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/12/26/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-5%E8%BF%90%E8%BE%93%E5%B1%82/" title="计算机网络-5运输层"><img src="/img/mn9.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机网络-5运输层"/></a><div class="content"><a class="title" href="/2021/12/26/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-5%E8%BF%90%E8%BE%93%E5%B1%82/" title="计算机网络-5运输层">计算机网络-5运输层</a><time datetime="2021-12-26T13:14:31.000Z" title="发表于 2021-12-26 21:14:31">2021-12-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/12/25/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-4%E7%BD%91%E7%BB%9C%E5%B1%82/" title="计算机网络-4网络层"><img src="/img/mn8.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机网络-4网络层"/></a><div class="content"><a class="title" href="/2021/12/25/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-4%E7%BD%91%E7%BB%9C%E5%B1%82/" title="计算机网络-4网络层">计算机网络-4网络层</a><time datetime="2021-12-25T13:14:31.000Z" title="发表于 2021-12-25 21:14:31">2021-12-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/12/25/2022%E5%B9%B4%E5%85%A8%E5%9B%BD%E7%A0%94%E7%A9%B6%E7%94%9F%E5%85%A5%E5%AD%A6%E8%80%83%E8%AF%95%E7%AC%AC%E4%B8%80%E5%A4%A9/" title="2022年全国研究生入学考试第一天"><img src="/img/kyjy.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2022年全国研究生入学考试第一天"/></a><div class="content"><a class="title" href="/2021/12/25/2022%E5%B9%B4%E5%85%A8%E5%9B%BD%E7%A0%94%E7%A9%B6%E7%94%9F%E5%85%A5%E5%AD%A6%E8%80%83%E8%AF%95%E7%AC%AC%E4%B8%80%E5%A4%A9/" title="2022年全国研究生入学考试第一天">2022年全国研究生入学考试第一天</a><time datetime="2021-12-25T00:08:26.000Z" title="发表于 2021-12-25 08:08:26">2021-12-25</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By 马厚煜</div><div class="footer_custom_text">Hi, welcome to my blog!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>